# API 비용 분석

## 1. Google Custom Search API (커스텀 서치)

### 비용 구조
- **무료 할당량**: 하루 100회 검색
- **유료**: $5 / 10,000회 = **$0.0005 / 회**
- **월 100회 이하**: 무료
- **월 1,000회**: 약 $0.45
- **월 10,000회**: 약 $4.50

### 현재 사용량 (설계서 분석 시)
- 설계서 이미지 1개당: **4회 검색**
  - 상품명 + "후기"
  - 상품명 + "특약"
  - 상품명 + "장점"
  - 상품명 + "가입"

### 예상 비용
- **일 10개 설계서 분석**: 40회 검색 → **무료** (100회 이하)
- **일 30개 설계서 분석**: 120회 검색 → 20회 유료 = **$0.01/일**
- **월 1,000개 설계서 분석**: 4,000회 검색 → 3,900회 유료 = **약 $1.95/월**

---

## 2. Gemini Grounding (그라운딩)

### 비용 구조
- **별도 비용 없음** (토큰 사용량에 포함)
- 그라운딩으로 인해 **입력 토큰이 증가**할 수 있음
- 검색 결과가 프롬프트에 포함되어 토큰 수 증가

### 토큰 비용 (현재 설정)
- **Gemini 2.0 Flash**:
  - 입력: **$0.10 / 1M 토큰**
  - 출력: **$0.40 / 1M 토큰**
  
- **Gemini 2.5 Pro**:
  - 입력: **$1.25 / 1M 토큰**
  - 출력: **$10.00 / 1M 토큰**

### 그라운딩으로 인한 추가 비용
- 그라운딩이 활성화되면 검색 결과가 입력 토큰에 포함
- 예상 추가 토큰: 500-2,000 토큰 (검색 결과 크기에 따라)
- **Flash 기준**: 추가 $0.00005 - $0.0002 (거의 무시 가능)
- **Pro 기준**: 추가 $0.000625 - $0.0025

---

## 3. 전체 비용 예시

### 시나리오 1: 설계서 분석 1회
- **커스텀 서치**: 4회 → 무료 (100회 이하)
- **Gemini API**: 
  - Flash 사용 시: 약 5,000 토큰 입력 + 1,000 토큰 출력
  - 비용: (5,000/1M × $0.10) + (1,000/1M × $0.40) = **$0.0009**
- **총 비용**: 약 **$0.0009** (약 1원)

### 시나리오 2: Q&A 생성 1세트
- **커스텀 서치**: 4-8회 (상품명, 타겟, 고민점, 판매포인트)
- **Gemini API**:
  - 질문 생성 (Flash): 약 3,000 토큰 입력 + 500 토큰 출력 = $0.0005
  - 답변 생성 (Pro): 약 8,000 토큰 입력 + 2,000 토큰 출력 = $0.03
  - 대화형 스레드 (혼합): 약 5,000 토큰 입력 + 1,000 토큰 출력 = $0.001
- **총 비용**: 약 **$0.0315** (약 40원)

### 시나리오 3: 월 1,000개 설계서 분석
- **커스텀 서치**: 4,000회 → 약 **$1.95**
- **Gemini API**: 1,000회 × $0.0009 = **$0.90**
- **총 비용**: 약 **$2.85/월**

---

## 4. 비용 절감 팁

### 커스텀 서치
1. **무료 할당량 활용**: 하루 100회 이하로 사용
2. **검색 쿼리 최적화**: 중복 검색 방지
3. **캐싱**: 같은 상품명에 대한 검색 결과 캐싱

### Gemini API
1. **Flash 모델 우선 사용**: 질문 생성 등 간단한 작업에 Flash 사용
2. **프롬프트 최적화**: 불필요한 텍스트 제거
3. **그라운딩 선택적 사용**: 필요할 때만 활성화

---

## 5. 모니터링

현재 코드에서 토큰 사용량과 비용을 추적하고 있습니다:
- `tokenUsage` 배열에 모든 API 호출의 토큰 사용량 저장
- `estimateCost()` 함수로 비용 계산
- API 응답에 `costEstimate` 포함

