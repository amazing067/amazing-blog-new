# 보안 가이드

## ✅ 현재 보안 상태

### 1. API 키 보안 (안전)

**중요한 API 키들은 모두 서버 사이드에서만 사용됩니다:**

- ✅ `GEMINI_API_KEY` - 서버 사이드 API 라우트에서만 사용 (`/api/generate`, `/api/generate-qa` 등)
- ✅ `GOOGLE_API_KEY` - 서버 사이드에서만 사용
- ✅ `GOOGLE_CUSTOM_SEARCH_ENGINE_ID` - 서버 사이드에서만 사용
- ✅ `GOOGLE_SHEETS_ID` - 서버 사이드에서만 사용

**확인 방법:**
- 모든 API 키는 `process.env.GEMINI_API_KEY` 형식으로 사용 (NEXT_PUBLIC_ 접두사 없음)
- 클라이언트 사이드 코드에서 접근 불가능
- 브라우저 개발자 도구에서 확인 불가능

### 2. 공개되는 환경 변수 (의도된 공개)

**Supabase 관련:**
- `NEXT_PUBLIC_SUPABASE_URL` - Supabase 프로젝트 URL (공개되어도 안전)
- `NEXT_PUBLIC_SUPABASE_ANON_KEY` - Supabase Anon Key (공개되어도 안전, RLS로 보호됨)

**이것들은 의도적으로 공개됩니다:**
- Supabase는 Row Level Security (RLS)로 데이터 보호
- Anon Key는 읽기 전용 권한만 가지고 있음
- 사용자별 데이터 접근은 RLS 정책으로 제어됨

## ⚠️ 개발자 도구로 볼 수 있는 것

### 1. 프론트엔드 코드 (공개됨)

**브라우저 개발자 도구로 볼 수 있는 것:**
- ✅ HTML 구조
- ✅ CSS 스타일
- ✅ JavaScript 코드 (번들된 형태)
- ✅ React 컴포넌트 구조
- ✅ 네트워크 요청/응답

**이것은 모든 웹사이트의 특성입니다:**
- 프론트엔드 코드는 기본적으로 공개됨
- 이것을 완전히 숨기는 것은 불가능
- 하지만 중요한 비즈니스 로직은 서버 사이드에 있음

### 2. 디자인 복사

**복사 가능한 것:**
- ✅ CSS 스타일
- ✅ 레이아웃 구조
- ✅ 색상, 폰트, 애니메이션
- ✅ UI 컴포넌트 디자인

**보호 방법:**
- 디자인 자체는 복사 가능하지만, 이것은 일반적인 웹의 특성
- 중요한 것은 **비즈니스 로직과 데이터**가 보호되는 것

## 🔒 보호되는 것

### 1. 서버 사이드 로직

**완전히 보호됨:**
- ✅ API 라우트 코드 (`/app/api/*`)
- ✅ 프롬프트 로직 (`/lib/prompts/*`)
- ✅ 데이터 처리 로직
- ✅ 비즈니스 로직

**확인 방법:**
- 브라우저 개발자 도구에서 확인 불가능
- 서버에서만 실행됨

### 2. API 키 및 비밀 정보

**완전히 보호됨:**
- ✅ Gemini API 키
- ✅ Google API 키
- ✅ Google Sheets ID
- ✅ 기타 비밀 정보

**확인 방법:**
- 브라우저 개발자 도구에서 확인 불가능
- 네트워크 탭에서도 확인 불가능 (서버 사이드에서만 사용)

### 3. 사용자 데이터

**보호됨:**
- ✅ Supabase RLS (Row Level Security)로 보호
- ✅ 사용자는 자신의 데이터만 접근 가능
- ✅ 관리자만 모든 데이터 접근 가능

## 🛡️ 추가 보안 권장사항

### 1. API 라우트 보호 강화 (선택사항)

현재는 인증된 사용자만 접근 가능하지만, 더 강화할 수 있습니다:

```typescript
// app/api/generate/route.ts
export async function POST(request: NextRequest) {
  // 사용자 인증 확인
  const supabase = await createClient()
  const { data: { user } } = await supabase.auth.getUser()
  
  if (!user) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
  }
  
  // 프로필 확인
  const { data: profile } = await supabase
    .from('profiles')
    .select('is_approved')
    .eq('id', user.id)
    .single()
  
  if (!profile?.is_approved) {
    return NextResponse.json({ error: 'Not approved' }, { status: 403 })
  }
  
  // ... 나머지 로직
}
```

### 2. Rate Limiting (선택사항)

API 남용 방지를 위한 Rate Limiting 추가:

```typescript
// app/api/generate/route.ts
import { Ratelimit } from "@upstash/ratelimit"
import { Redis } from "@upstash/redis"

const ratelimit = new Ratelimit({
  redis: Redis.fromEnv(),
  limiter: Ratelimit.slidingWindow(10, "1 h"), // 1시간에 10회
})

export async function POST(request: NextRequest) {
  const ip = request.ip ?? "127.0.0.1"
  const { success } = await ratelimit.limit(ip)
  
  if (!success) {
    return NextResponse.json({ error: 'Rate limit exceeded' }, { status: 429 })
  }
  
  // ... 나머지 로직
}
```

### 3. 환경 변수 관리

**현재 상태:**
- ✅ `.env.local`은 Git에 커밋되지 않음 (`.gitignore`에 포함)
- ✅ Vercel 환경 변수는 안전하게 관리됨

**권장사항:**
- 환경 변수는 절대 Git에 커밋하지 않기
- Vercel 환경 변수는 정기적으로 확인
- API 키는 정기적으로 로테이션 (선택사항)

## 📋 보안 체크리스트

- [x] API 키는 서버 사이드에서만 사용
- [x] NEXT_PUBLIC_ 접두사는 공개해도 안전한 것만 사용
- [x] 사용자 인증 및 권한 확인
- [x] Supabase RLS 활성화
- [x] 환경 변수는 Git에 커밋되지 않음
- [ ] API Rate Limiting (선택사항)
- [ ] API 라우트 추가 인증 확인 (선택사항)

## 🎯 결론

### 현재 보안 상태: ✅ 안전

1. **중요한 API 키는 모두 보호됨**
   - 클라이언트에 노출되지 않음
   - 서버 사이드에서만 사용

2. **프론트엔드 코드는 공개되지만**
   - 이것은 모든 웹사이트의 특성
   - 중요한 비즈니스 로직은 서버에 있음

3. **디자인은 복사 가능하지만**
   - 이것은 일반적인 웹의 특성
   - 중요한 것은 데이터와 로직이 보호되는 것

### 추가 보안이 필요한 경우

- API Rate Limiting 추가
- API 라우트에 추가 인증 확인
- 로깅 및 모니터링 강화

## 💡 참고

**웹 보안의 기본 원칙:**
- 프론트엔드 코드는 기본적으로 공개됨
- 중요한 것은 **서버 사이드 보안**
- API 키와 비밀 정보는 절대 클라이언트에 노출하지 않기
- 사용자 인증 및 권한 확인은 필수

**현재 프로젝트는 이 원칙들을 모두 준수하고 있습니다.**

