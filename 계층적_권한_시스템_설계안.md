# κ³„μΈµμ  κ¶ν• μ‹μ¤ν… μ„¤κ³„μ• (λ³Έλ¶€μ¥ β†’ ν€μ¥ β†’ FC)

## π“‹ μ”κµ¬μ‚¬ν•­ μ •λ¦¬

### κ¶ν• κ³„μΈµ κµ¬μ΅°
```
κ΄€λ¦¬μ (admin)
  β””β”€ λ¨λ“  μ‚¬μ©μ ν†µκ³„ μ΅°ν κ°€λ¥

λ³Έλ¶€μ¥ (department_head)
  β””β”€ κ°™μ€ λ³Έλ¶€μ ν€μ¥ + FC ν†µκ³„ μ΅°ν κ°€λ¥

ν€μ¥ (team_leader)
  β””β”€ κ°™μ€ ν€μ FC ν†µκ³„ μ΅°ν κ°€λ¥

FC (field_consultant) / μΌλ° μ‚¬μ©μ (user)
  β””β”€ μμ‹ μ ν†µκ³„λ§ μ΅°ν κ°€λ¥
```

### ν†µκ³„ μ΅°ν κ¶ν• λ§¤νΈλ¦­μ¤

| μ—­ν•  | μμ‹  | κ°™μ€ ν€ FC | λ‹¤λ¥Έ ν€ FC | ν€μ¥ | λ³Έλ¶€μ¥ | λ‹¤λ¥Έ λ³Έλ¶€ |
|------|------|------------|-----------|------|--------|----------|
| FC | β… | β | β | β | β | β |
| ν€μ¥ | β… | β… | β | β… (κ°™μ€ ν€) | β | β |
| λ³Έλ¶€μ¥ | β… | β… (κ°™μ€ λ³Έλ¶€) | β | β… (κ°™μ€ λ³Έλ¶€) | β… (κ°™μ€ λ³Έλ¶€) | β |
| κ΄€λ¦¬μ | β… | β… | β… | β… | β… | β… |

---

## π—„οΈ λ°μ΄ν„°λ² μ΄μ¤ μ¤ν‚¤λ§ μ„¤κ³„

### 1. profiles ν…μ΄λΈ” ν•„λ“ μ¶”κ°€

```sql
-- profiles ν…μ΄λΈ”μ— λ³Έλ¶€/ν€ κ΄€λ ¨ ν•„λ“ μ¶”κ°€
ALTER TABLE profiles
ADD COLUMN IF NOT EXISTS department_id TEXT,        -- λ³Έλ¶€ ID (μ: 'seoul', 'busan')
ADD COLUMN IF NOT EXISTS department_name TEXT,      -- λ³Έλ¶€λ… (μ: 'μ„μΈλ³Έλ¶€', 'λ¶€μ‚°λ³Έλ¶€')
ADD COLUMN IF NOT EXISTS team_id TEXT,               -- ν€ ID (μ: 'seoul-team1', 'seoul-team2')
ADD COLUMN IF NOT EXISTS team_name TEXT;             -- ν€λ… (μ: 'μ„μΈλ³Έλ¶€ 1ν€', 'μ„μΈλ³Έλ¶€ 2ν€')

-- role ν™•μ¥: 'user' | 'admin' | 'department_head' | 'team_leader' | 'fc'
-- κΈ°μ΅΄ 'user'λ” 'fc'λ΅ ν†µμΌν•κ±°λ‚, 'fc'λ¥Ό μƒλ΅ μ¶”κ°€

-- μΈλ±μ¤ μƒμ„±
CREATE INDEX IF NOT EXISTS profiles_department_id_idx ON profiles(department_id);
CREATE INDEX IF NOT EXISTS profiles_team_id_idx ON profiles(team_id);
CREATE INDEX IF NOT EXISTS profiles_role_idx ON profiles(role);
```

### 2. μ—­ν•  μ •μ

```typescript
// lib/constants/roles.ts
export const ROLES = {
  ADMIN: 'admin',                    // κ΄€λ¦¬μ
  DEPARTMENT_HEAD: 'department_head', // λ³Έλ¶€μ¥
  TEAM_LEADER: 'team_leader',        // ν€μ¥
  FC: 'fc',                          // FC (Field Consultant)
  USER: 'user',                      // μΌλ° μ‚¬μ©μ (κΈ°μ΅΄ νΈν™μ„±)
} as const

export type Role = typeof ROLES[keyof typeof ROLES]
```

### 3. λ³Έλ¶€/ν€ λ°μ΄ν„° κµ¬μ΅° (ν•λ“μ½”λ”© λλ” ν…μ΄λΈ”)

```typescript
// lib/constants/departments.ts
export const DEPARTMENTS = [
  {
    id: 'seoul',
    name: 'μ„μΈλ³Έλ¶€',
    teams: [
      { id: 'seoul-team1', name: 'μ„μΈλ³Έλ¶€ 1ν€' },
      { id: 'seoul-team2', name: 'μ„μΈλ³Έλ¶€ 2ν€' },
      { id: 'seoul-team3', name: 'μ„μΈλ³Έλ¶€ 3ν€' },
    ]
  },
  {
    id: 'busan',
    name: 'λ¶€μ‚°λ³Έλ¶€',
    teams: [
      { id: 'busan-team1', name: 'λ¶€μ‚°λ³Έλ¶€ 1ν€' },
      { id: 'busan-team2', name: 'λ¶€μ‚°λ³Έλ¶€ 2ν€' },
    ]
  },
  {
    id: 'daegu',
    name: 'λ€κµ¬λ³Έλ¶€',
    teams: [
      { id: 'daegu-team1', name: 'λ€κµ¬λ³Έλ¶€ 1ν€' },
    ]
  },
] as const
```

---

## π” κ¶ν• μ²΄ν¬ λ΅μ§

### 1. ν†µκ³„ μ΅°ν κ¶ν• μ²΄ν¬ ν•¨μ

```typescript
// lib/auth/permissions.ts

export interface UserProfile {
  id: string
  role: string
  department_id: string | null
  team_id: string | null
}

/**
 * μ‚¬μ©μκ°€ νΉμ • μ‚¬μ©μμ ν†µκ³„λ¥Ό λ³Ό μ μλ”μ§€ ν™•μΈ
 */
export function canViewUserStats(
  viewer: UserProfile,
  targetUser: UserProfile
): boolean {
  // κ΄€λ¦¬μλ” λ¨λ“  μ‚¬μ©μ ν†µκ³„ μ΅°ν κ°€λ¥
  if (viewer.role === 'admin') return true

  // μμ‹ μ ν†µκ³„λ” ν•­μƒ μ΅°ν κ°€λ¥
  if (viewer.id === targetUser.id) return true

  // λ³Έλ¶€μ¥: κ°™μ€ λ³Έλ¶€μ λ¨λ“  μ‚¬μ©μ ν†µκ³„ μ΅°ν κ°€λ¥
  if (viewer.role === 'department_head') {
    return viewer.department_id === targetUser.department_id
  }

  // ν€μ¥: κ°™μ€ ν€μ μ‚¬μ©μ ν†µκ³„ μ΅°ν κ°€λ¥
  if (viewer.role === 'team_leader') {
    // κ°™μ€ ν€μ FC λλ” κ°™μ€ ν€μ λ‹¤λ¥Έ ν€μ¥
    return viewer.team_id === targetUser.team_id
  }

  // FC/μΌλ° μ‚¬μ©μ: μμ‹ μ ν†µκ³„λ§ μ΅°ν κ°€λ¥
  return false
}

/**
 * ν† ν° μ‚¬μ©λ‰ μ΅°ν κ¶ν• (κ΄€λ¦¬μλ§)
 */
export function canViewTokenUsage(userRole: string): boolean {
  return userRole === 'admin'
}

/**
 * μ‚¬μ©μκ°€ λ³Ό μ μλ” μ‚¬μ©μ λ©λ΅ μ΅°ν
 */
export function getViewableUserIds(
  viewer: UserProfile,
  allUsers: UserProfile[]
): string[] {
  if (viewer.role === 'admin') {
    // κ΄€λ¦¬μλ” λ¨λ“  μ‚¬μ©μ
    return allUsers.map(u => u.id)
  }

  if (viewer.role === 'department_head') {
    // λ³Έλ¶€μ¥: κ°™μ€ λ³Έλ¶€μ λ¨λ“  μ‚¬μ©μ
    return allUsers
      .filter(u => u.department_id === viewer.department_id)
      .map(u => u.id)
  }

  if (viewer.role === 'team_leader') {
    // ν€μ¥: κ°™μ€ ν€μ λ¨λ“  μ‚¬μ©μ
    return allUsers
      .filter(u => u.team_id === viewer.team_id)
      .map(u => u.id)
  }

  // FC/μΌλ° μ‚¬μ©μ: μμ‹ λ§
  return [viewer.id]
}
```

---

## π“ ν†µκ³„ μΏΌλ¦¬ μ„¤κ³„

### 1. λ³Έλ¶€μ¥μ© ν†µκ³„ μΏΌλ¦¬

```sql
-- λ³Έλ¶€μ¥: κ°™μ€ λ³Έλ¶€μ λ¨λ“  μ‚¬μ©μ ν†µκ³„
SELECT 
  p.id,
  p.username,
  p.full_name,
  p.role,
  p.team_name,
  COUNT(DISTINCT bp.id) as blog_count,
  COUNT(DISTINCT qa.id) as qa_count
FROM profiles p
LEFT JOIN blog_posts bp ON bp.user_id = p.id
LEFT JOIN qa_sets qa ON qa.user_id = p.id
WHERE p.department_id = $1  -- λ³Έλ¶€μ¥μ λ³Έλ¶€ ID
  AND p.role != 'admin'
GROUP BY p.id, p.username, p.full_name, p.role, p.team_name
ORDER BY p.team_name, p.role, blog_count DESC;
```

### 2. ν€μ¥μ© ν†µκ³„ μΏΌλ¦¬

```sql
-- ν€μ¥: κ°™μ€ ν€μ λ¨λ“  μ‚¬μ©μ ν†µκ³„
SELECT 
  p.id,
  p.username,
  p.full_name,
  p.role,
  COUNT(DISTINCT bp.id) as blog_count,
  COUNT(DISTINCT qa.id) as qa_count
FROM profiles p
LEFT JOIN blog_posts bp ON bp.user_id = p.id
LEFT JOIN qa_sets qa ON qa.user_id = p.id
WHERE p.team_id = $1  -- ν€μ¥μ ν€ ID
  AND p.role != 'admin'
GROUP BY p.id, p.username, p.full_name, p.role
ORDER BY p.role, blog_count DESC;
```

### 3. κ΄€λ¦¬μμ© ν†µκ³„ μΏΌλ¦¬ (ν† ν° ν¬ν•¨)

```sql
-- κ΄€λ¦¬μ: λ¨λ“  μ‚¬μ©μ ν†µκ³„ (ν† ν° ν¬ν•¨)
SELECT 
  p.id,
  p.username,
  p.full_name,
  p.role,
  p.department_name,
  p.team_name,
  COUNT(DISTINCT bp.id) as blog_count,
  COUNT(DISTINCT qa.id) as qa_count,
  COALESCE(SUM(ul.total_tokens), 0) as total_tokens,
  COALESCE(SUM(ul.cost_estimate), 0) as total_cost
FROM profiles p
LEFT JOIN blog_posts bp ON bp.user_id = p.id
LEFT JOIN qa_sets qa ON qa.user_id = p.id
LEFT JOIN usage_logs ul ON ul.user_id = p.id
GROUP BY p.id, p.username, p.full_name, p.role, p.department_name, p.team_name
ORDER BY p.department_name, p.team_name, p.role, blog_count DESC;
```

---

## π¨ UI/UX μ„¤κ³„

### 1. νμ›κ°€μ… ν™”λ©΄

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ νμ›κ°€μ…                            β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ λ³Έλ¶€ μ„ νƒ: [μ„μΈλ³Έλ¶€ β–Ό]             β”‚
β”‚ ν€ μ„ νƒ:   [μ„μΈλ³Έλ¶€ 1ν€ β–Ό]        β”‚
β”‚                                     β”‚
β”‚ (λ³Έλ¶€ μ„ νƒ μ‹ ν•΄λ‹Ή λ³Έλ¶€μ ν€ λ©λ΅ ν‘μ‹)β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

### 2. κ΄€λ¦¬μ νμ› κ΄€λ¦¬ ν™”λ©΄

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ νμ› κ΄€λ¦¬                           β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ [λ³Έλ¶€ ν•„ν„°] [ν€ ν•„ν„°] [μ—­ν•  ν•„ν„°]   β”‚
β”‚                                     β”‚
β”‚ μ‚¬μ©μλ… | λ³Έλ¶€ | ν€ | μ—­ν•  | μ•΅μ…  β”‚
β”‚ ν™κΈΈλ™   | μ„μΈ | 1ν€| FC  | [μ—­ν• λ³€κ²½]β”‚
β”‚ κΉ€μ² μ   | μ„μΈ | 1ν€| ν€μ¥| [μ—­ν• λ³€κ²½]β”‚
β”‚ μ΄μν¬   | μ„μΈ | -  | λ³Έλ¶€μ¥|[μ—­ν• λ³€κ²½]β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

### 3. ν†µκ³„ ν™”λ©΄ (μ—­ν• λ³„)

#### FCμ© ν†µκ³„
```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ λ‚΄ ν†µκ³„                             β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ κΈ€ μ: 15κ±΄                         β”‚
β”‚ Q&A μ: 8κ±΄                         β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

#### ν€μ¥μ© ν†µκ³„
```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ μ„μΈλ³Έλ¶€ 1ν€ ν†µκ³„                   β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ μ‚¬μ©μλ… | μ—­ν•  | κΈ€ μ | Q&A μ    β”‚
β”‚ κΉ€μ² μ   | ν€μ¥ |  20  |  12       β”‚
β”‚ ν™κΈΈλ™   | FC   |  15  |   8       β”‚
β”‚ λ°•λ―Όμ   | FC   |  10  |   6       β”‚
β”‚                                     β”‚
β”‚ ν€ ν•©κ³„: 45κ±΄ | 26κ±΄                β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

#### λ³Έλ¶€μ¥μ© ν†µκ³„
```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ μ„μΈλ³Έλ¶€ ν†µκ³„                       β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ [ν€ ν•„ν„°] [μ „μ²΄] β–Ό                  β”‚
β”‚                                     β”‚
β”‚ μ‚¬μ©μλ… | ν€ | μ—­ν•  | κΈ€ μ | Q&A  β”‚
β”‚ μ΄μν¬   | -  | λ³Έλ¶€μ¥|  25  |  15  β”‚
β”‚ κΉ€μ² μ   | 1ν€| ν€μ¥ |  20  |  12  β”‚
β”‚ ν™κΈΈλ™   | 1ν€| FC   |  15  |   8  β”‚
β”‚ λ°•λ―Όμ   | 2ν€| ν€μ¥ |  18  |  10  β”‚
β”‚                                     β”‚
β”‚ λ³Έλ¶€ ν•©κ³„: 78κ±΄ | 45κ±΄               β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

#### κ΄€λ¦¬μμ© ν†µκ³„ (ν† ν° ν¬ν•¨)
```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ μ „μ²΄ ν†µκ³„ (κ΄€λ¦¬μ μ „μ©)              β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ [λ³Έλ¶€ ν•„ν„°] [ν€ ν•„ν„°] [μ „μ²΄] β–Ό      β”‚
β”‚                                     β”‚
β”‚ μ‚¬μ©μλ…|λ³Έλ¶€|ν€|μ—­ν• |κΈ€|Q&A|ν† ν°|λΉ„μ©β”‚
β”‚ ν™κΈΈλ™  |μ„μΈ|1ν€|FC |15| 8 |1.2M|β‚©12Kβ”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

---

## π’» κµ¬ν„ κ³„ν

### Phase 1: λ°μ΄ν„°λ² μ΄μ¤ μ¤ν‚¤λ§ μ—…λ°μ΄νΈ

1. **SQL λ§μ΄κ·Έλ μ΄μ… νμΌ μƒμ„±**
   ```sql
   -- supabase-schema-department-team.sql
   ALTER TABLE profiles
   ADD COLUMN IF NOT EXISTS department_id TEXT,
   ADD COLUMN IF NOT EXISTS department_name TEXT,
   ADD COLUMN IF NOT EXISTS team_id TEXT,
   ADD COLUMN IF NOT EXISTS team_name TEXT;
   ```

2. **κΈ°μ΅΄ μ‚¬μ©μ λ§μ΄κ·Έλ μ΄μ…**
   - κΈ°μ΅΄ μ‚¬μ©μλ“¤μ λ³Έλ¶€/ν€ μ •λ³΄ μ„¤μ •
   - κ΄€λ¦¬μκ°€ μλ™μΌλ΅ μ„¤μ •

### Phase 2: κ¶ν• μ²΄ν¬ λ΅μ§ κµ¬ν„

1. **κ¶ν• μ²΄ν¬ μ ν‹Έλ¦¬ν‹° ν•¨μ μƒμ„±**
   - `lib/auth/permissions.ts` μƒμ„±
   - `canViewUserStats()`, `getViewableUserIds()` κµ¬ν„

2. **RLS μ •μ±… μ—…λ°μ΄νΈ**
   - λ³Έλ¶€μ¥/ν€μ¥μ΄ ν•΄λ‹Ή μ‚¬μ©μλ“¤μ λ°μ΄ν„°λ¥Ό μ΅°νν•  μ μλ„λ΅ μ •μ±… μ¶”κ°€

### Phase 3: UI κµ¬ν„

1. **νμ›κ°€μ… ν™”λ©΄ μμ •**
   - λ³Έλ¶€ μ„ νƒ λ“λ΅­λ‹¤μ΄
   - ν€ μ„ νƒ λ“λ΅­λ‹¤μ΄ (λ³Έλ¶€ μ„ νƒ μ‹ λ™μ  λ΅λ“)
   - `app/signup/page.tsx` μμ •

2. **κ΄€λ¦¬μ νμ› κ΄€λ¦¬ ν™”λ©΄ μμ •**
   - λ³Έλ¶€/ν€ ν•„ν„° μ¶”κ°€
   - μ—­ν•  λ³€κ²½ κΈ°λ¥ (FC β†” ν€μ¥ β†” λ³Έλ¶€μ¥)
   - `app/admin/users/page.tsx` μμ •

3. **ν†µκ³„ ν™”λ©΄ λ¶„λ¦¬**
   - FCμ©: `app/dashboard/stats/page.tsx` (μμ‹ μ ν†µκ³„λ§)
   - ν€μ¥μ©: `app/team/stats/page.tsx` (κ°™μ€ ν€ ν†µκ³„)
   - λ³Έλ¶€μ¥μ©: `app/department/stats/page.tsx` (κ°™μ€ λ³Έλ¶€ ν†µκ³„)
   - κ΄€λ¦¬μμ©: `app/admin/stats/page.tsx` (κΈ°μ΅΄ μ μ§€, ν† ν° ν¬ν•¨)

### Phase 4: API μμ •

1. **ν†µκ³„ API μμ •**
   - `app/api/admin/stats/route.ts` μμ •
   - μ—­ν• μ— λ”°λΌ λ‹¤λ¥Έ λ°μ΄ν„° λ°ν™
   - λ³Έλ¶€μ¥/ν€μ¥μ€ ν† ν° μ •λ³΄ μ μ™Έ

2. **μƒ API μ—”λ“ν¬μΈνΈ μƒμ„±**
   - `app/api/team/stats/route.ts` (ν€μ¥μ©)
   - `app/api/department/stats/route.ts` (λ³Έλ¶€μ¥μ©)

---

## π”§ κµ¬μ²΄μ  κµ¬ν„ μμ‹

### 1. λ³Έλ¶€/ν€ μƒμ μ •μ

```typescript
// lib/constants/departments.ts
export const DEPARTMENTS = [
  {
    id: 'seoul',
    name: 'μ„μΈλ³Έλ¶€',
    teams: [
      { id: 'seoul-team1', name: 'μ„μΈλ³Έλ¶€ 1ν€' },
      { id: 'seoul-team2', name: 'μ„μΈλ³Έλ¶€ 2ν€' },
      { id: 'seoul-team3', name: 'μ„μΈλ³Έλ¶€ 3ν€' },
    ]
  },
  {
    id: 'busan',
    name: 'λ¶€μ‚°λ³Έλ¶€',
    teams: [
      { id: 'busan-team1', name: 'λ¶€μ‚°λ³Έλ¶€ 1ν€' },
      { id: 'busan-team2', name: 'λ¶€μ‚°λ³Έλ¶€ 2ν€' },
    ]
  },
] as const

export function getTeamsByDepartment(departmentId: string) {
  const dept = DEPARTMENTS.find(d => d.id === departmentId)
  return dept?.teams || []
}
```

### 2. ν†µκ³„ API μμ‹

```typescript
// app/api/team/stats/route.ts
export async function GET(request: NextRequest) {
  const supabase = await createClient()
  const { data: { user } } = await supabase.auth.getUser()
  
  if (!user) {
    return NextResponse.json({ error: 'μΈμ¦ ν•„μ”' }, { status: 401 })
  }

  const { data: profile } = await supabase
    .from('profiles')
    .select('id, role, team_id, department_id')
    .eq('id', user.id)
    .single()

  if (profile?.role !== 'team_leader') {
    return NextResponse.json({ error: 'κ¶ν• μ—†μ' }, { status: 403 })
  }

  // κ°™μ€ ν€μ μ‚¬μ©μλ“¤ ν†µκ³„ μ΅°ν
  const { data: teamUsers } = await supabase
    .from('profiles')
    .select('id, username, full_name, role')
    .eq('team_id', profile.team_id)

  // ν†µκ³„ κ³„μ‚° (ν† ν° μ μ™Έ)
  const stats = await calculateStats(teamUsers.map(u => u.id), false)
  
  return NextResponse.json({ users: stats })
}
```

---

## β… κµ¬ν„ κ°€λ¥ μ—¬λ¶€

**μ™„μ „ν κ°€λ¥ν•©λ‹λ‹¤!** 

μ΄ κµ¬μ΅°λ”:
- β… κ³„μΈµμ  κ¶ν• κµ¬μ΅°λ¥Ό λ…ν™•ν κµ¬ν„ κ°€λ¥
- β… λ°μ΄ν„°λ² μ΄μ¤ μ¤ν‚¤λ§λ΅ μ¶©λ¶„ν ν‘ν„ κ°€λ¥
- β… RLS μ •μ±…μΌλ΅ λ³΄μ• μ μ§€ κ°€λ¥
- β… UIλ΅ μ§κ΄€μ μΌλ΅ ν‘ν„ κ°€λ¥

---

## π€ λ‹¤μ λ‹¨κ³„

1. **λ°μ΄ν„°λ² μ΄μ¤ μ¤ν‚¤λ§ μ—…λ°μ΄νΈ SQL μƒμ„±**
2. **κ¶ν• μ²΄ν¬ λ΅μ§ κµ¬ν„**
3. **νμ›κ°€μ…/νμ› κ΄€λ¦¬ ν™”λ©΄μ— λ³Έλ¶€/ν€ μ„ νƒ μ¶”κ°€**
4. **ν†µκ³„ ν™”λ©΄ μ—­ν• λ³„ λ¶„λ¦¬**
5. **API μ—”λ“ν¬μΈνΈ κµ¬ν„**

μ–΄λ–¤ λ‹¨κ³„λ¶€ν„° μ‹μ‘ν• κΉμ”?

