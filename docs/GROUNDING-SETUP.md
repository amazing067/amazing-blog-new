# Gemini Grounding 설정 가이드

> Gemini API가 실시간으로 웹을 검색하여 최신 통계를 찾아 사용하는 기능

---

## 🎯 Grounding이란?

**Gemini가 자동으로:**
1. 필요한 정보가 있으면 웹 검색
2. 신뢰할 수 있는 출처에서 데이터 추출
3. 출처와 함께 콘텐츠에 포함
4. 최신 정보 자동 업데이트

**결과:**
- ✅ 통계를 일일이 찾을 필요 없음
- ✅ 항상 최신 데이터
- ✅ 출처 자동 명시 (심의 통과)
- ✅ 전문성 대폭 향상

---

## 📋 설정 방법 (2단계)

### Step 1: Google Cloud Console 설정

#### 1-1. API 활성화

```
1. https://console.cloud.google.com/ 접속
2. 프로젝트 선택 (amazing-blog)
3. 왼쪽 메뉴 → "API 및 서비스" → "라이브러리"
4. 검색: "Generative Language API"
5. 이미 활성화되어 있음 ✅
```

**추가 확인:**
```
검색: "Grounded Generation API" 또는 "Search Grounding"
→ 있으면 [사용 설정] 클릭
→ 없으면 OK (Generative Language API에 포함됨)
```

---

### Step 2: 코드 설정 (이미 완료! ✅)

#### 2-1. 모델 선택

**app/api/generate/route.ts:**

```typescript
model: 'gemini-2.5-pro'  // 현재 사용 중
```

**사용 가능 모델:**
- ✅ `gemini-2.5-pro` (현재, 최신!)
- ✅ `gemini-1.5-pro-latest` (안정적)
- ✅ `gemini-1.5-pro`
- ✅ `gemini-1.5-flash-latest` (빠름)

---

#### 2-2. 프롬프트에 지침 추가 (이미 완료! ✅)

**lib/prompts/insurance-blog-prompt.ts:**

```
E. [통계 사용 가이드 - 웹 검색 활용!]
→ 필요시 웹 검색으로 공식 통계 찾기
→ 신뢰 기관만 (건보공단, 질병청 등)
→ 출처 URL 명시
```

**Gemini가 자동으로 판단:**
- 통계 필요? → 웹 검색!
- 찾았음? → 출처와 함께 사용!
- 못 찾음? → 정성적 표현!

---

## 🧪 테스트 방법

### 테스트 1: 통계 검색 여부 확인

**주제 입력:**
```
"암 발생률 통계와 30세 남성 암보험 비교"
```

**결과 확인:**
```
✅ 암 발생률 수치 나옴?
✅ 출처 명시됨? (국가암정보센터 등)
✅ 최신 데이터? (2023~2024년)
```

---

### 테스트 2: 터미널 로그 확인

**서버 로그:**
```bash
npm run dev
```

**로그에서 찾기:**
```
블로그 생성 시작: ...
데이터 추출 완료: ...
프롬프트 생성 완료, Gemini 호출 중...
생성 완료! HTML 길이: XXXXX

→ 시간이 15~20초 걸리면 검색 작동 중! ✅
→ 10초 이하면 검색 안 함
```

---

## 💰 비용 (Grounding 사용 시)

### Gemini 1.5 Pro + Grounding

```
기본 토큰:
- 입력: $3.50/100만 토큰
- 출력: $10.50/100만 토큰

Grounding 추가:
- 검색 1회당: 약 $0.005 (5원)
- 검색된 데이터 토큰: 추가 과금

블로그 1개 (Grounding 사용):
- 기본: 40원
- Grounding: 10~20원
→ 총: 50~60원/글

월 1,000개:
→ 약 50,000~60,000원/월
```

**여전히 저렴해요!** 💰

---

## 🎯 현재 상태

```
✅ 모델: gemini-1.5-pro-latest
✅ 프롬프트: 웹 검색 지침 포함
✅ 출처 명시: 필수
✅ 심의 규정: 준수

→ 자동으로 작동! ✅
```

---

## 📊 Grounding 작동 원리

```
사용자 입력:
"30세 암보험 비교"
    ↓
Gemini 판단:
"암 발생률 통계 필요하네?"
    ↓
자동 웹 검색:
"국가암정보센터 2023 암등록통계"
    ↓
출처 확인:
cancer.go.kr → 신뢰 가능!
    ↓
콘텐츠에 포함:
"국가암정보센터 2023년 통계에 따르면,
연간 암 발생자는 약 25만명입니다.
(출처: 국가암정보센터)"
    ↓
완성! ✅
```

---

## ⚠️ 주의사항

### 1. 속도
```
Grounding 사용 시:
- 검색 시간: +5~10초
- 총 시간: 15~20초

안 사용 시:
- 총 시간: 7~10초

→ 품질 vs 속도 트레이드오프
```

### 2. 검색 안 될 때도 있음
```
Gemini가 판단:
"이 정보는 검색 필요 없음"
→ 프롬프트 내용으로만 작성
```

---

## 🚀 지금 바로 테스트!

**설정 완료됐어요!**

```
1. http://localhost:3000/dashboard
2. 주제: "암 발생률 통계와 30세 남성 암보험"
3. 키워드: "통계, 발생률, 가격비교"
4. [AI 글쓰기] 클릭!
5. 15~20초 대기 (검색 시간 포함)
```

---

## 📖 추가 개선 (나중에)

### 통계 DB 구축 (다음번)

```
Google Sheets 시트 추가:
- 4_공식_통계_DB (100행)

내용:
- 주요 통계 50~100개
- 출처 URL 포함
- Gemini가 우선 참조

→ 검색 시간 단축
→ 더 정확한 통계
```

---

---

## 📄 출처 다운로드 기능

### 작동 방식

```
블로그 생성 완료
    ↓
출처 자동 추출:
- 기본 출처 (보험료, 질병코드)
- 본문의 링크
- (출처: ...) 패턴
    ↓
[출처] 버튼 표시
    ↓
클릭하면 Markdown 다운로드
출처_주제_2024-12-04.md
```

### 파일 내용

```markdown
# 참고 자료 및 출처

1. **보험료 데이터**
   - 기관: 자체 수집 데이터
   - 날짜: 2024-12-04

2. **질병 코드**
   - 기관: 통계청 KCD-9
   - URL: https://www.koicd.kr/

3. **암등록통계** (사용 시 자동 추가)
   - 기관: 국가암정보센터
   - URL: https://cancer.go.kr/

---

본 자료는 블로그 작성 시 참고한 출처입니다.
```

### 사용 방법

```
1. 블로그 글 생성
2. 결과 확인
3. [출처] 버튼 클릭 (출처가 있을 때만 표시)
4. Markdown 파일 다운로드
5. 필요 시 PDF로 변환하여 제출
```

### Markdown을 PDF로 변환

**온라인 도구:**
- https://www.markdowntopdf.com/
- https://md2pdf.netlify.app/

**또는:**
- VSCode에서 Markdown PDF 확장 설치
- 파일 열고 우클릭 → "Markdown PDF: Export"

---

**지금 테스트해보세요!** 💪

통계를 사용하면 자동으로 출처가 추출돼요! 📚

결과 알려주세요! 😊
