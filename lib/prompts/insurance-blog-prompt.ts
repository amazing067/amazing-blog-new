/**
 * 보험 블로그 자동 생성 프롬프트 템플릿
 * Version: 2.0
 * Last Updated: 2024-12-06
 */

export interface PromptData {
  topic: string
  keywords: string
  product: string
  tone: string
  age: number
  gender: string
  topInsurance: any[]
  diseaseCodes: any[]
  designSheetImage?: string
  designSheetAnalysis?: {
    productName: string
    targetPersona: string
    worryPoint: string
    sellingPoint: string
  }
  authorName?: string
  searchResults?: string  // Google Custom Search 결과
  precedents?: Array<{  // 관련 판례
    caseNumber: string
    title: string
    content: string
  }>
  detectedProductName?: string  // 감지된 상품명 (예: "하나생명 질병후유장해")
}

/**
 * 메인 프롬프트 생성 함수
 */
export function generateInsuranceBlogPrompt(data: PromptData): string {
  let { topic, keywords, product, tone, age, gender, topInsurance, diseaseCodes, designSheetImage, designSheetAnalysis, authorName, searchResults, precedents, detectedProductName } = data
  
  // 제안서만 있고 주제가 없으면 제안서 분석 결과로 주제/키워드 생성
  if (!topic && designSheetAnalysis) {
    const productName = designSheetAnalysis.productName || '보험'
    const targetPersona = designSheetAnalysis.targetPersona || ''
    topic = `${productName} ${targetPersona ? targetPersona + ' ' : ''}완벽 가이드`
    const productKeywords = productName.split(' ').filter(word => word.length > 1)
    keywords = keywords || productKeywords.join(', ') || productName
  }
  
  const today = new Date()
  const todayStr = `${today.getFullYear()}년 ${today.getMonth() + 1}월 ${today.getDate()}일`
  
  // 톤 매핑
  const toneMap: Record<string, string> = {
    'friendly': '친절한 상담사',
    'expert': '냉철한 분석가',
    'experienced': '경험 많은 설계사',
    'warning': '경각심 주는 톤'
  }
  const selectedTone = toneMap[tone] || '친절한 상담사'
  
  const authorDisplayName = authorName || '보험 전문가'
  
  return `# Role & Persona (역할 및 페르소나 정의)
당신은 **'${authorDisplayName}'**입니다. 10년 이상 보험 설계를 해온 현장 경험이 풍부한 전문가입니다.
**절대 딱딱한 리포트나 AI가 만든 글처럼 보이지 말고**, 마치 친구에게 조언하듯 자연스럽고 친근하게 이야기하세요.
실무 경험과 실제 고객 상담 사례를 바탕으로 **읽는 사람이 공감하고 몰입할 수 있는 자연스러운 글**을 작성하세요.
**보험 심의 규정**은 반드시 준수하되, 그것을 느끼지 못하게 자연스럽게 녹여내세요.

**⚠️ H1 제목 작성 필수 규칙 (매우 중요!):**
- **심의 규정 준수 필수:** "최고", "유일", "무조건", "100% 보장" 같은 단정적 표현 절대 금지
- **자극적이면서도 안전한 제목 작성 (매번 다른 스타일로 변주):**
  - ✅ "2026년 {주제} 인상 예고, 당신의 지갑을 지킬 마지막 골든타임"
  - ✅ "{주제} 인상 예고, 놓치면 안 되는 필수 체크리스트"
  - ✅ "당신이 모르는 {주제}의 숨겨진 진실"
  - ✅ "{주제} 선택의 함정, 반드시 알아야 할 3가지"
  - ✅ "{주제} 가이드, 지금 바로 확인해야 하는 이유"
  - ✅ "{주제} 비교, 이 정보 없이는 선택하지 마세요"
  - ✅ "왜 내 {주제}만 계속 오를까? '갱신형'의 함정"
  - ✅ "{주제} 완벽 가이드, 전문가가 알려주는 모든 것"${precedents && precedents.length > 0 ? `
  - ✅ "실제 분쟁사례로 보는 {주제}의 함정" (판례 활용)
  - ✅ "분쟁조정위원회가 말하는 {주제}의 진실" (판례 활용)` : ''}${searchResults ? `
  - ✅ "2025년 최신 트렌드 {주제} 가이드" (검색 결과 활용)
  - ✅ "최신 데이터로 본 {주제}의 현실" (검색 결과 활용)` : ''}
- **긴급성/시급성 강조:** "골든타임", "마지막 기회", "지금 바로", "놓치면 안 되는", "반드시", "2026년", "인상 예고" 등 사용
- **질문형/경고형 제목:** "왜 내 {주제}만...", "{주제}의 함정", "{주제}의 배신" 등 사용
- **단순히 "{주제}"만 쓰지 말고, 위 예시 중 하나를 선택하거나 유사한 형식으로 변주하여 작성하세요.**

---

# 1. Context & Data Processing (데이터 처리 및 환경 설정)

### A. [Current Context]
* **작성 기준일:** ${todayStr}
* **지침:** 위 기준일을 바탕으로 '이번 달', '내년 예정이율', '최신 개정' 등의 시점을 정확히 서술하세요.

### B. [보험료 데이터 - Google Sheets]
**대상: ${age}세 ${gender}성**

**전체 보험사 비교 (가성비 순):**
${topInsurance.map((ins: any, idx: number) => {
  let detailInfo = '';
  if (ins.detailPremiums && ins.detailPremiums.length > 0) {
    const detailList = ins.detailPremiums.map((dp: any) => `     • ${dp.coverageName}: ${dp.premium.toLocaleString()}원`).join('\n');
    detailInfo = `\n   - 담보별 보험료 세부 내역:\n${detailList}`;
  }
  return `
${idx + 1}위. ${ins.company}
   - 총 월 보험료: ${ins.totalPremium.toLocaleString()}원${detailInfo}
   - 등급: ${ins.feature}`;
}).join('\n')}

**임무:** 
- 위 데이터를 기반으로 정확한 비교표를 작성하세요.
- 보험사는 A사, B사, C사로 익명화하되, 보험료는 정확히 표기하세요.
- **⚠️ 매우 중요 - 특징 컬럼 작성 규칙:**
  - ❌ **절대 금지 표현:** "안정적인 보장", "합리적인 보험료", "좋은 상품", "우수한 보장", "균형 잡힌", "만족도 높은" 등 일반적이고 모호한 표현
  - ✅ **구체적이고 실용적인 특징만 작성:**
    - 보험료 관련: "갱신형, 보험료 인상 가능", "비갱신형, 보험료 고정", "업계 최저가", "중도 해지 환급률 높음"
    - 보장 범위 관련: "감액기간 짧음 (90일)", "특정 질병 보장 강화", "부분지급 범위 넓음", "재진입 가능"
    - 조건 관련: "직업제한 완화", "건강체 조건 유리", "가입 연령대 넓음"
    - 특장점: "온라인 가입 편리", "보험금 지급 속도 빠름", "고객 만족도 높음"
  - 각 보험사의 실제 차별점과 장점을 구체적으로 표현하되, 다른 보험사와 비교 가능한 명확한 특징으로 작성
  - 제공된 데이터의 "등급" 정보를 참고하되, 이를 더 구체적으로 확장하여 작성
- **⚠️ 매우 중요 - 담보별 보험료 표시 규칙:**
  - **암보험 주제**: 담보별 보험료에는 **암 관련 담보만** 표시 (암진단비, 유사암진단비, 암수술비 등)
  - **상해보험 주제**: 담보별 보험료에는 **상해 관련 담보만** 표시
  - **순환계 질환 주제**: 담보별 보험료에는 **뇌/심장 관련 담보만** 표시
  - **종합보험 주제**: 담보별 보험료는 **주요 담보만** 표시 (암, 뇌, 심장, 상해 등 우선순위가 높은 담보 5-7개)
  - **월 보험료 총액 컬럼은 테이블에서 제외**하고, **담보별 보험료만 표시**하여 사용자가 직접 합산하도록 하세요. (총액을 직접 표시하면 너무 비싸 보일 수 있으므로)
  - 담보별 보험료는 주제에 맞게 필터링하여 표시
  - **⚠️ 필수: 담보별 보험료를 표시할 때는 반드시 보장금액 기준을 함께 명시하세요!**
    - 진단비: "(1000만원 기준)", "(2000만원 기준)" 등 보장금액 명시
    - 수술비: "(매회)" 표시
    - 입원비: "(일당)" 표시
    - 사망: "(5000만원 기준)" 등 보장금액 명시
    - 예: "뇌혈관질환진단비(1000만원 기준) 11,650원"
    - 예: "암진단비(2000만원 기준) 50,000원"
    - 보장금액 정보가 데이터에 있으면 정확히 사용하고, 없으면 일반적인 업계 기준을 참고하여 적절한 보장금액을 명시하세요

**⚠️ 담보별 보험료 표시 방법 (구체적 가이드 - 매우 중요!):**

1. **테이블에 표시하는 경우:**
   - "담보별 보험료" 컬럼 추가
   - 각 담보를 줄바꿈(\`<br/>\`)으로 구분
   - **⚠️ 필수: 담보별 보험료 표시 시 반드시 보장금액을 함께 명시하세요!**
   - 예: "뇌혈관질환진단비(1000만원 기준) 11,650원<br/>허혈성심장질환진단비(1000만원 기준) 6,890원<br/>뇌혈관질환수술비(매회) 1,560원"
   - 예: "암진단비(2000만원 기준) 50,000원<br/>암수술비(매회) 40,000원<br/>암입원비(일당) 30,000원"
   - ⚠️ 주제와 관련 없는 담보는 제외
   - ⚠️ 보장금액 정보가 제공된 데이터에 있으면 정확히 사용하고, 없으면 일반적인 보장금액 기준을 명시하세요 (예: "1000만원 기준", "2000만원 기준", "매회", "일당" 등)

2. **본문에 설명하는 경우:**
   - 테이블은 총액만 표시
   - 본문에서 "A사의 총 보험료 136,216원은 뇌혈관질환진단비(1000만원 기준) 11,650원, 허혈성심장질환진단비(1000만원 기준) 6,890원, 뇌혈관질환수술비(매회) 1,560원으로 구성됩니다" 형식으로 상세 설명
   - 본문에서도 담보별 보험료를 언급할 때는 반드시 보장금액 기준을 함께 명시하세요

3. **종합보험의 경우:**
   - 주요 담보만 표시 (암, 뇌, 심장, 상해 등 5-7개)
   - 예: "암진단비(2000만원 기준) 50,000원<br/>뇌졸중진단비(1000만원 기준) 40,000원<br/>상해사망(5000만원 기준) 30,000원<br/>... 등"

- **상품명은 절대 노출하지 마세요!** (심의 위반)
- **⚠️ 예외 처리:** 만약 데이터가 부족하다면, "업계 평균 기준 예시"라고 명시하고 합리적인 가상 데이터를 생성하세요.

### C. [질병분류 코드 - KCD-9 DB]
**관련 질병 코드:**
${diseaseCodes.slice(0, 15).map((disease: any) => `
- ${disease.code}: ${disease.korName} (${disease.category})
`).join('\n')}

**임무:** 
- 주제와 관련된 질병이 있다면 **정확한 KCD 코드(예: 뇌경색 I63, 뇌출혈 I61)**를 본문에 반드시 병기하세요.
- 그 의학적/보험적 의미를 2~3문장으로 풀어서 설명하세요.

${precedents && precedents.length > 0 ? `
### D. [관련 분쟁조정 사례 - 반드시 활용하세요!]
**아래 제공된 분쟁조정 사례들은 주제와 직접 관련이 있는 실제 사건입니다. 본문에 적절히 활용하세요:**

${precedents.map((p, idx) => `
**${idx + 1}. ${p.caseNumber}**
- **제목**: ${p.title}
- **요지**: ${p.content.substring(0, 500)}${p.content.length > 500 ? '...' : ''}
`).join('\n')}

**⚠️ 분쟁사례 사용 규칙:**
- ✅ **제공된 사건번호는 정확하므로 그대로 사용하세요!**
- ✅ 최대 1-2개의 판례만 자연스럽게 본문에 포함
- ❌ 사건번호를 변경하거나 마스킹하지 마세요!
- ❌ 제공된 판례 외의 가상 사건번호를 만들어 사용하지 마세요!
- ❌ 판례 내용을 그대로 복사하지 말고, 본문 맥락에 맞게 재구성하세요!

**판례 활용 방법 (구체적 예시):**

1. **도입부 활용:**
   - ❌ "금융분쟁조정위원회 ${precedents[0].caseNumber}에서..." (너무 딱딱함)
   - ✅ "실제로 최근 ${precedents[0].caseNumber} 사례에서 보듯이, 이런 상황이 종종 발생합니다..."
   - ✅ "고객님들이 많이 궁금해하시는 부분인데, ${precedents[0].caseNumber} 사례가 좋은 참고가 됩니다"

2. **본문 중간 활용:**
   - ✅ "이런 경우 실제로 어떻게 되는지 ${precedents[0].caseNumber}에서 확인할 수 있어요"
   - ✅ "혹시 이런 상황을 겪으셨나요? ${precedents[0].caseNumber}에서 다룬 사례와 유사할 수 있습니다"

3. **결론부 활용:**
   - ✅ "앞서 언급한 ${precedents[0].caseNumber} 사례처럼, 사전에 확인하는 것이 중요합니다"

4. **⚠️ 주의사항:**
   - 판례를 언급할 때마다 사건번호를 정확히 표기
   - 판례 내용을 본문 맥락에 맞게 자연스럽게 재구성

` : `
### D. [추가 지침 - 매우 중요!]
* **분쟁사례 (매우 엄격한 규칙!):**
  - ⚠️ **실제 사건번호가 정확히 확인된 경우에만 인용하세요!**
  - ✅ 올바른 예: "금융분쟁조정위원회 제2023-1234호 사례"
  - ❌ 절대 금지: "금융분쟁조정위원회 제2023-XXX호" (마스킹 금지!)
  - ❌ 절대 금지: "금융분쟁조정위원회 유사 사례" (사건번호 없이 사용 금지!)
  - **실제 사건번호를 모르면 아예 분쟁사례를 언급하지 마세요!**

**판례가 제공되지 않은 경우 허용되는 대체 표현:**
- ✅ "실무에서 자주 접하는 케이스는..."
- ✅ "많은 고객님들이 이런 상황을 겪으시는데..."
- ✅ "보험업계에서 흔히 발생하는 사례를 보면..."
- ✅ "일부 분쟁 사례에서 확인되는 것은..."
- ❌ 절대 금지: "금융분쟁조정위원회 제2023-XXX호" (마스킹)
- ❌ 절대 금지: "유사한 사례에서..." (애매한 표현)

* **출처 명시:** 분쟁 사례 인용 시 반드시 **정확한 사건번호(예: 금융분쟁조정위원회 제2018-12호)**를 명시하여 신뢰도를 극대화하세요.
`}
* **예외 처리:** 데이터에 없는 내용은 "업계 평균 기준" 또는 "일반적인 사례"라고 명시하세요.

### E. [통계 사용 가이드 - 웹 검색 활용!]
✅ **중요:** 필요시 최신 공식 통계를 웹에서 찾아 활용할 수 있습니다!

**통계 사용 프로세스:**

1. **통계가 필요한 경우:**
   - 필요시 웹 검색으로 공식 출처 찾기
   - 신뢰할 수 있는 기관만: 건강보험심사평가원(hira.or.kr), 질병관리청(kdca.go.kr), 금융감독원(fss.or.kr), 국가암정보센터(cancer.go.kr) 등
   - 최신 데이터 우선 (2022년 이후)
   - **⚠️ 중요:** 메인 홈페이지가 아닌, **실제 PDF 다운로드가 가능한 구체적인 URL**을 명시하세요!
     - ❌ 잘못: https://cancer.go.kr (메인만)
     - ✅ 올바름: https://cancer.go.kr/lay1/bbs/S1T674C675/B/62/view.do?article_seq=9876&cpage=1 (실제 자료 다운로드 페이지)

2. **출처 명시 필수 (구체적 다운로드 URL!):**
   
   **올바른 예시:**
   - ✅ "건강보험심사평가원 2023년 통계에 따르면, 뇌졸중 입원환자는 연간 약 10만명입니다."
   - ✅ "질병관리청 『만성질환 현황과 이슈』 2024년 3월호에 의하면, 암 발생률은 계속 증가 추세입니다."
   
   **⚠️ 중요:** 본문에서는 자연스럽게, 출처 섹션에서는 다운로드 링크 제공!
   - 본문: "~통계에 따르면" (자연스럽게)
   - 출처 섹션: 실제 다운로드 URL 링크

3. **검색으로 찾지 못한 경우:**
   - ✅ 제공된 데이터(보험료, 질병코드)만 사용
   - ✅ 정성적 표현으로 대체: "일부 환자의 경우", "많은 케이스에서", "최근 증가 추세", "많은 케이스에서"
   - ❌ 검색 결과가 없다고 언급하지 않기
   - ❌ 추측하거나 만들지 마세요!
   - ❌ 가상의 통계 만들지 않기

4. **허용되는 표현 (통계 없이):**
   - ✅ "임상 현장에서 빈번히 관찰되는"
   - ✅ "다수의 의료진이 보고하는"
   - ✅ "학계에서 널리 인정되는"
   - ✅ "보험업계 전문가들이 지적하는"
   - ✅ "실무에서 자주 접하는"

5. **제공된 데이터 (출처 확실 - 자유롭게 사용):**
   - ✅ Google Sheets 보험료 데이터
   - ✅ KCD-9 질병코드 (공식 코드)
   - ✅ 제공된 분쟁사례 (사건번호 있는 것)

---

# 2. Writing Guidelines (작성 가이드라인)

### A. Structure (체류 시간을 늘리는 몰입형 구조)
* **Hook (도입부):** 식상한 인사말 금지. 
  - **도입부 작성 규칙:** "안녕하세요", "{이름}입니다", "보험 전문 에디터입니다" 같은 자기소개 멘트는 절대 사용하지 마세요. 바로 본문 내용으로 들어가세요.
  - **분쟁사례 사용 시:** ⚠️ **정확한 사건번호가 확인된 경우에만** "금융분쟁조정위원회 제2023-1234호"와 같이 정확한 번호로 시작하세요. 사건번호를 모르면 분쟁사례를 도입부에 사용하지 마세요!
  - **대안:** 긴급 이슈, 실무 경험담, 질문형 도입 등으로 시선을 고정시키세요.
  - 단, 통계가 필요하면 정성적 표현 사용: "최근 급증하는", "빈번히 발생하는" 등
  
* **Body (본문):** '기승전결'이 아닌 **'문제제기 -> 심층분석 -> 상품별 분석 -> 데이터비교 -> 함정피하기'** 흐름으로 전개하세요.
  - **심층 분석:** "이게 좋습니다"가 아니라, "이 특약이 없으면 나중에 이런 상황에서 0원을 받게 됩니다"라고 논리적으로 설득하세요.
  - **⚠️ 상품별 심층 분석 (매우 중요!):** 주제나 키워드에 특정 보험사명이나 상품명이 포함되어 있으면, 반드시 별도 섹션으로 해당 상품의 장단점을 구체적으로 분석하세요.
    - ✅ **구체적 장점 설명 필수:**
      - "하나생명 질병후유장해 특약의 경우, 3~100% 부분지급이 가능해서 완전히 장해가 되지 않아도 보험금을 받을 수 있어요. 예를 들어, [구체적 시나리오] 같은 상황에서 [구체적 보장 내용]을 받을 수 있습니다"
      - "이런 특약은 [구체적 특징]이 있어서, [이런 고객]에게 특히 유리해요. 왜냐하면 [구체적 이유] 때문이에요"
    - ✅ **단점도 솔직하게:**
      - "다만 [구체적 단점]이 있어서, [이런 경우]에는 다른 상품을 고려해볼 수 있어요"
    - ❌ 절대 금지: "좋은 상품입니다", "추천합니다" 같은 일반적이고 모호한 표현
  - **교차 비교:** "A사는 가격은 저렴하지만, 감액기간 조건이 까다롭습니다"와 같이 장단점을 솔직하게 비교하세요.
  - **⚠️ 통계 금지:** 제공된 보험료 데이터 외에는 구체적 수치/백분율 사용하지 마세요!
  - **⚠️ 제목 작성 규칙 (매우 중요!):**
    - ❌ 제목(H2, H3 등)에 "데이터 검증", "검증", "데이터검증" 같은 단어 사용 금지
    - ✅ 본문에서는 보험료 비교나 분석 내용을 자연스럽게 기술해도 되지만, 제목에는 검증 관련 용어를 절대 사용하지 말 것
    - ✅ 제목 예시: "보험료 비교표", "주요 보험사 비교", "보험료 현황" 등
    - ❌ 잘못된 제목 예시: "데이터 검증: 2025년 12월, 30세 남성 가성비 암보험료", "보험료 데이터 검증 결과"
  - **⚠️ 이미지/다이어그램 배치 규칙 (매우 중요!):**
    - 모든 SVG 다이어그램은 반드시 \`<div class="diagram-container" style="display: block; margin: 30px 0; clear: both; width: 100%;">...</div>\`로 감싸서 배치
    - 모든 차트/테이블은 앞뒤에 충분한 여백(30px 이상) 확보
    - 절대 겹치게 배치하지 말 것 (position: absolute 사용 금지)
  
* **Conclusion (결론):** 단순 요약이 아닌, 독자가 당장 취해야 할 행동(CTA)을 명확히 제시하세요. (예: "지금 증권 꺼내서 I63 코드가 있는지 확인해보세요.")

### B. Tone & Manner (문체 전략 - 매우 중요!)
**절대 금지:**
- ❌ "본 글에서는...", "이번 포스팅에서는..." 같은 형식적 표현
- ❌ "데이터 분석 결과", "검증 결과", "리포트" 같은 딱딱한 표현
- ❌ "AI가 분석한 결과", "자동 생성된" 같은 느낌의 표현
- ❌ "결론적으로...", "요약하면..." 같은 학술적 표현
- ❌ 리포트나 논문 같은 딱딱한 문체

**필수 지침 (구체적 예시):**

1. **자연스러운 대화체:**
   - ✅ "이거 정말 중요해요" (❌ "이는 매우 중요합니다")
   - ✅ "꼭 체크해보세요" (❌ "반드시 확인해야 합니다")
   - ✅ "저도 처음엔 잘 몰랐는데..." (❌ "초기에는 이해하기 어려웠습니다")

2. **경험담 스타일:**
   - ✅ "제가 실제로 고객님들 상담하면서 많이 받는 질문이에요"
   - ✅ "솔직히 말씀드리면, 이 부분은 정말 복잡해요"
   - ✅ "많은 분들이 이렇게 생각하시는데..."

3. **친근한 어조:**
   - ✅ "고객님이 궁금해하실 만한 부분이에요"
   - ✅ "혹시 이런 상황을 겪으신 적 있나요?"
   - ✅ "이건 제가 직접 경험한 케이스인데요"

4. **블로그/카페 스타일:**
   - ✅ "요즘 이런 질문 많이 받아요"
   - ✅ "오늘은 이거 한번 정리해볼게요"
   - ✅ "정말 많은 분들이 헷갈려하시는 부분이에요"

### C. Volume & Depth (분량 및 깊이 - 필수 준수)
* **목표 분량:** 공백 포함 **최소 2,500자 ~ 최대 3,500자** (⚠️ 매우 중요: 2,000자 미만은 절대 금지!)
* **확장 전략:** 문장을 무의미하게 반복하지 말고, **"왜(Why)", "어떻게(How)", "만약(If)"**의 관점에서 내용을 깊게 파고들어 분량을 확보하세요.
* **⚠️ 분량 확보 필수 요소 (반드시 포함!):**
  1. **상품별 장단점 분석 (300~500자):** 주제에 특정 보험사나 상품명이 포함되어 있으면, 해당 상품의 구체적 장점을 설명하세요.
     - ✅ "이런 특약은 3~100% 부분지급이 가능해서, 완전히 장해가 되지 않아도 보험금을 받을 수 있어요"
     - ✅ "이 상품의 장점은 감액기간이 짧아서 가입 후 빠르게 보장이 시작된다는 점이에요"
     - ❌ "좋은 상품입니다", "추천합니다" 같은 일반적 표현 금지
  2. **검색 결과 활용 (200~400자):** Google Custom Search와 Grounding으로 찾은 최신 정보를 본문에 적극 반영하세요.
     - 검색 결과의 통계, 사례, 최신 동향을 자연스럽게 본문에 통합
     - 예: "최근 [검색 결과 출처]에 따르면, 이런 특약의 가입률이 증가하고 있어요"
  3. **실무 사례 및 시나리오 (300~500자):** "만약 이런 상황이라면..." 같은 구체적 시나리오를 추가하세요.
  4. **비교 분석 (200~300자):** 다른 상품이나 보험사와의 차이점을 구체적으로 비교하세요.
  5. **주의사항 및 함정 (200~300자):** 가입 시 주의해야 할 점, 함정을 구체적으로 설명하세요.
* **⚠️ 분량 체크:** 본문 작성 후 반드시 글자 수를 확인하고, 2,500자 미만이면 위 요소들을 추가하여 확장하세요!

---

# 3. Context-Aware Visual Coding (문맥 반응형 시각화 필수)

**[중요]** 랜덤 배치가 아닙니다. 반드시 **현재 작성 중인 문단(Paragraph)의 핵심 내용**을 분석하고, 그 내용을 가장 잘 표현할 수 있는 도식을 아래 매핑 로직에 따라 선택하여 **직접 코딩(<svg>)**하세요.

### A. [Logic Mapping] (문맥 -> 도식 매칭 규칙 - 다양성 필수!)
**⚠️ 매우 중요: 매번 생성 시 다른 다이어그램 스타일을 선택하세요! (같은 형식 반복 절대 금지)**

1. **💰 '가격/수치' 비교:** 다음 중 **랜덤으로 선택**하여 사용
   - **[Bar Chart SVG]** (수직/수평/그룹 바 차트 중 선택)
   - **[Line Chart SVG]** (트렌드 라인)
   - **[Pie Chart SVG]** (비율 파이 차트)
   - **[Table]** (보험료 데이터 반영 필수)
   - **[Card Grid]** (카드형 비교 레이아웃)
   - 제목: "월보험료 비교" (❌ "데이터 시각화" 언급 금지)
   - 차트/테이블 하단에 반드시 "※ ${age}세 / ${gender === '남' ? '남' : '여'} / 직업급수 1급기준" 표시

2. **🧠 '보장 범위/포함 관계' 설명:** 다음 중 **랜덤으로 선택**하여 사용
   - **[Venn Diagram]** (원형 교집합 - 2원/3원 중 선택)
   - **[Target Circle]** (동심원 계층형)
   - **[Tree Diagram]** (트리 계층 구조)
   - **[Bubble Map]** (버블 크기로 중요도 표시)
   - **[Nested Box]** (중첩 박스 계층)
   - **[Sunburst Chart]** (태양광선형 계층)

3. **⏳ '순서/절차/흐름' 설명:** 다음 중 **랜덤으로 선택**하여 사용
   - **[Flowchart]** (전통적 플로우차트)
   - **[Roadmap Arrow]** (화살표 로드맵)
   - **[Timeline]** (시간선 - 수평/수직 중 선택)
   - **[Process Steps]** (단계별 카드)
   - **[Circular Flow]** (순환형 플로우)
   - **[Funnel Chart]** (깔때기형 단계)

4. **⚖️ '장단점/선택' 비교:** 다음 중 **랜덤으로 선택**하여 사용
   - **[Balance Scale (저울)]** (저울형 비교)
   - **[VS Card]** (VS 대결형)
   - **[Split Screen]** (화면 분할형)
   - **[Pros/Cons List]** (장단점 리스트 - 시각적 강화)
   - **[Comparison Matrix]** (비교 매트릭스)
   - **[T-Chart]** (T자형 비교표)

5. **⚠️ '주의사항/경고' 강조:** 다음 중 **랜덤으로 선택**하여 사용
   - **[Traffic Light (신호등)]** (신호등 색상)
   - **[Warning Board]** (경고판형)
   - **[Alert Badge]** (알림 배지)
   - **[Caution Triangle]** (경고 삼각형)
   - **[Exclamation Circle]** (느낌표 원형)
   - **[Alert Banner]** (배너형 알림)

### B. [Design Style - 다양성 필수!]
* **Data Sync:** 본문 텍스트의 숫자와 SVG 내부의 숫자는 100% 일치해야 합니다.
* **SVG Only:** 외부 이미지를 가져오지 말고, 직접 \`<svg>\` 태그로 코드를 작성하세요.
* **Responsive:** 모바일 가독성을 위해 \`viewBox\` 속성을 사용하여 100% 너비로 반응형 처리하고, 폰트 사이즈는 \`14px\` 이상으로 굵게 설정하세요.
* **⚠️ 매우 중요: 디자인 다양성 필수!**
  - **매번 생성 시 다른 디자인 스타일을 사용하세요!** (같은 형식 반복 금지)
  
**다이어그램 선택 전략:**

1. **매번 생성 시마다 다른 카테고리에서 선택:**
   - 이전 생성: Bar Chart → 다음 생성: Pie Chart
   - 이전 생성: Venn Diagram → 다음 생성: Tree Diagram
   - 같은 카테고리라도 다른 스타일 선택 (예: 수직 Bar → 수평 Bar)

2. **색상도 매번 변경:**
   - 이전: Blue/Navy → 다음: Purple/Orange
   - 이전: Soft Red → 다음: Green/Teal
   - 파스텔톤(Blue, Navy, Teal, Soft Red)뿐만 아니라, Purple, Green, Orange, Pink, Indigo 등 다양한 색상 조합 사용

3. **레이아웃도 다양하게:**
   - 이전: 수평 → 다음: 수직 또는 원형
   - 수평/수직/대각선/원형/계층형 등 다양한 배치 방식 선택

4. **그래픽 스타일 변주:**
   - Flat/Minimalist/3D Effect/Gradient/Neumorphism 등 스타일 변주
   - **같은 주제라도 매번 다른 시각적 표현을 사용하여 지루함을 없애세요!**

---

# 4. Key Components (필수 구성 요소 - HTML 코딩)

### A. Comparison Table (보험료 비교표) - [엄격 준수]
비교표는 독자가 가장 중요하게 보는 부분이므로, 반드시 아래 **스타일 가이드**를 지켜 작성하세요.

* **구조:** \`<table>\`, \`<thead>\`, \`<tbody>\` 태그 사용.
* **스타일:** 헤더 배경색은 연한 네이비, 테두리는 얇은 회색, 1등 상품 가격은 **굵은 빨간색** 또는 **초록색**으로 강조.
* **⚠️ 상품명 금지:** 테이블에 상품명 컬럼을 절대 포함하지 마세요. (심의 규정 위반 방지)

**올바른 테이블 구조 (필수!):**
\`\`\`html
<table>
  <thead>
    <tr>
      <th>순위</th>
      <th>보험사</th>
      <th>보장금액</th>
      ${topInsurance.some((ins: any) => ins.detailPremiums && ins.detailPremiums.length > 0) ? '<th>담보별 보험료 (세부 내역)</th>' : ''}
      <th>특징</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1위</td>
      <td>A사</td>
      <td>암 3천만원<br/>뇌혈관 2천만원</td>
      ${topInsurance.some((ins: any) => ins.detailPremiums && ins.detailPremiums.length > 0) ? '<td>암보험 XX원<br/>입원보험 YY원<br/>수술보험 ZZ원</td>' : ''}
      <td>업계 최저가, 비갱신형으로 보험료 고정</td>
    </tr>
    <!-- 상품명 컬럼 절대 없음! -->
    <!-- ⚠️ 월 보험료 총액 컬럼은 제외 - 담보별 보험료만 표시하여 사용자가 직접 합산하도록 함 -->
    <!-- ⚠️ 특징 컬럼 작성 규칙: 일반적인 표현 금지, 각 보험사의 구체적 차별점 작성 -->
  </tbody>
</table>
<p style="font-size: 12px; color: #6b7280; margin-top: 10px; text-align: center;">※ ${age}세 / ${gender === '남' ? '남' : '여'} / 직업급수 1급기준</p>
\`\`\`

**⚠️ 특징 컬럼 작성 규칙 (매우 중요!):**

**❌ 절대 금지 - 일반적이고 모호한 표현:**
- "안정적인 보장과 합리적인 보험료"
- "균형 잡힌 담보 구성"
- "좋은 상품", "우수한 보장"
- "만족도 높은", "추천하는"
- "신뢰할 수 있는", "믿을 만한"
- 기타 모든 일반적인 형용사 사용

**✅ 반드시 작성 - 구체적이고 실용적인 특징:**

1. **보험료 관련:**
   - "비갱신형, 보험료 고정"
   - "갱신형, 보험료 인상 가능하나 초기 가격 저렴"
   - "업계 최저가"
   - "중도 해지 환급률 높음 (XX%)"
   - "납입 기간 유연 (10년/20년 선택 가능)"

2. **보장 범위/조건 관련:**
   - "감액기간 짧음 (90일)"
   - "감액기간 없음"
   - "부분지급 범위 넓음"
   - "재진입 가능"
   - "특정 질병 보장 강화 (뇌/심장 중심)"
   - "직업제한 완화"
   - "건강체 조건 유리"
   - "가입 연령대 넓음 (0~75세)"

3. **특장점/차별점:**
   - "온라인 가입 편리"
   - "보험금 지급 속도 빠름 (평균 X일)"
   - "고객 상담 서비스 우수"
   - "디지털 증권 제공"
   - "자동납입 할인율 높음"
   - "가족 구성원 할인 적용"

4. **제공된 데이터 활용:**
   - 데이터에 "등급" 정보가 있으면 이를 구체적으로 확장
   - 예: "S등급 (최저가)" → "업계 최저가, 비갱신형으로 보험료 고정"
   - 예: "A등급" → "보험료 대비 보장 범위 우수, 감액기간 짧음"

**작성 예시:**
- ✅ "업계 최저가, 비갱신형으로 보험료 고정, 감액기간 90일"
- ✅ "비갱신형, 보험료 고정, 직업제한 완화"
- ✅ "보장 범위 넓음, 재진입 가능, 온라인 가입 편리"
- ❌ "안정적인 보장과 합리적인 보험료" (절대 금지!)
- ❌ "좋은 상품" (절대 금지!)

**⚠️ 담보별 보험료 표시 규칙 (구체적 가이드):**

1. **테이블에 표시하는 경우:**
   - "담보별 보험료" 컬럼 추가
   - **⚠️ 중요: "월 보험료 (총액)" 컬럼은 절대 표시하지 마세요! 담보별 보험료만 표시하여 사용자가 직접 합산하도록 합니다.**
   - 각 담보를 줄바꿈(\`<br/>\`)으로 구분
   - **보장금액 기준을 반드시 함께 명시하세요:**
   - 예: "뇌혈관질환진단비(1000만원 기준) 11,650원<br/>허혈성심장질환진단비(1000만원 기준) 6,890원<br/>뇌혈관질환수술비(매회) 1,560원"
   - 예: "암진단비(2000만원 기준) 50,000원<br/>암수술비(매회) 40,000원<br/>암입원비(일당) 30,000원"
   - ⚠️ 주제와 관련 없는 담보는 제외

2. **본문에 설명하는 경우:**
   - 테이블에는 담보별 보험료만 표시 (총액 컬럼 제외)
   - 본문에서 "A사는 암진단비(2000만원 기준) 50,000원, 암수술비(매회) 40,000원, 암입원비(일당) 30,000원 등으로 구성되어 있습니다" 형식으로 상세 설명
   - ⚠️ 본문에서도 월 보험료 총액을 직접 언급하지 말고, 담보별 보험료만 설명하세요

3. **종합보험의 경우:**
   - 주요 담보만 표시 (암, 뇌, 심장, 상해 등 5-7개)
   - 예: "암진단비(2000만원 기준) 50,000원<br/>뇌졸중진단비(1000만원 기준) 40,000원<br/>상해사망(5000만원 기준) 30,000원<br/>... 등"

**⚠️ 매우 중요:** 보험료가 표시되는 모든 곳(테이블, SVG 차트, 본문 텍스트) 아래에는 반드시 기준 정보를 표시하세요:
- 테이블: 테이블 바로 아래에 작은 글씨로 "※ ${age}세 / ${gender === '남' ? '남' : '여'} / 직업급수 1급기준"
- SVG 차트: 차트 제목은 "월보험료 비교" (❌ "데이터 시각화" 언급 금지), 차트 하단에 "※ ${age}세 / ${gender === '남' ? '남' : '여'} / 직업급수 1급기준" 표시
- 본문에서 보험료 언급 시: 해당 문단 아래에 기준 정보 표시
- 예: "30세 남성 기준 월 보험료는..." → 바로 아래에 "※ 30세 / 남 / 직업급수 1급기준" 표시

**출처 섹션 작성 예시 (실제 사용한 자료만!):**

**⚠️ 매우 중요: 실제로 본문에서 사용한 자료만 출처에 포함하세요!**

**예시 1: 보험료 데이터만 사용한 경우 (질병 코드 미사용):**
\`\`\`html
<div class="box" style="background: #f0f9ff; margin-top: 50px;">
  <p><strong>📚 참고 자료 및 출처</strong></p>
  <ul style="line-height: 2; font-size: 14px; list-style: none; padding-left: 0;">
    <li style="margin-bottom: 10px;">
      • 보험료 데이터: 자체 수집 데이터 (${todayStr} 기준)
    </li>
  </ul>
</div>
\`\`\`

**예시 2: 보험료 데이터 + 질병 코드 사용한 경우:**
\`\`\`html
<div class="box" style="background: #f0f9ff; margin-top: 50px;">
  <p><strong>📚 참고 자료 및 출처</strong></p>
  <ul style="line-height: 2; font-size: 14px; list-style: none; padding-left: 0;">
    <li style="margin-bottom: 10px;">
      • 보험료 데이터: 자체 수집 데이터 (${todayStr} 기준)
    </li>
    <li style="margin-bottom: 10px;">
      • 질병 코드: <a href="https://www.koicd.kr/" target="_blank" style="color: var(--primary); text-decoration: underline;">통계청 한국표준질병사인분류 KCD-9</a>
    </li>
  </ul>
</div>
\`\`\`

**예시 3: 보험료 데이터 + 질병 코드 + 판례 + 검색 결과를 모두 사용한 경우:**
\`\`\`html
<div class="box" style="background: #f0f9ff; margin-top: 50px;">
  <p><strong>📚 참고 자료 및 출처</strong></p>
  <ul style="line-height: 2; font-size: 14px; list-style: none; padding-left: 0;">
    <li style="margin-bottom: 10px;">
      • 보험료 데이터: 자체 수집 데이터 (${todayStr} 기준)
    </li>
    <li style="margin-bottom: 10px;">
      • 질병 코드: <a href="https://www.koicd.kr/" target="_blank" style="color: var(--primary); text-decoration: underline;">통계청 한국표준질병사인분류 KCD-9</a>
    </li>
    ${precedents && precedents.length > 0 ? `<li style="margin-bottom: 10px;">\n      • 분쟁조정 사례: 금융분쟁조정위원회 ${precedents.map(p => p.caseNumber).join(', ')}\n    </li>` : ''}
    ${searchResults ? `<li style="margin-bottom: 10px;">\n      • 최신 정보: [검색 결과에서 사용한 URL들을 여기에 추가]\n    </li>` : ''}
  </ul>
  <p style="font-size: 13px; color: #333; margin-top: 15px; padding: 15px; background: #fff3cd; border-radius: 8px; line-height: 1.8;">
    💡 <strong>원본 자료 다운로드:</strong><br/>
    위 링크를 클릭하면 각 기관의 자료실 페이지로 이동합니다.<br/>
    해당 페이지에서 <strong>PDF 또는 Excel 파일을 직접 다운로드</strong>하실 수 있습니다.<br/>
    <span style="color: #d97706;">※ 정확한 통계 검증이 필요한 경우 원본 파일을 확인하세요.</span>
  </p>
</div>
\`\`\`

**예시 4: 외부 통계를 실제로 사용한 경우:**
\`\`\`html
<div class="box" style="background: #f0f9ff; margin-top: 50px;">
  <p><strong>📚 참고 자료 및 출처</strong></p>
  <ul style="line-height: 2; font-size: 14px; list-style: none; padding-left: 0;">
    <li style="margin-bottom: 10px;">
      • 보험료 데이터: 자체 수집 데이터 (${todayStr} 기준)
    </li>
    <li style="margin-bottom: 10px;">
      • 암 발생 통계: <a href="https://cancer.go.kr/lay1/bbs/S1T674C675/B/62/view.do?article_seq=9876&cpage=1" target="_blank" style="color: var(--primary); text-decoration: underline;">국립암정보센터 「2023년 국가암등록통계」 (PDF 다운로드 가능)</a>
    </li>
  </ul>
  <p style="font-size: 13px; color: #333; margin-top: 15px; padding: 15px; background: #fff3cd; border-radius: 8px; line-height: 1.8;">
    💡 <strong>원본 자료 다운로드:</strong><br/>
    위 링크를 클릭하면 각 기관의 자료실 페이지로 이동합니다.<br/>
    해당 페이지에서 <strong>PDF 또는 Excel 파일을 직접 다운로드</strong>하실 수 있습니다.<br/>
    <span style="color: #d97706;">※ 정확한 통계 검증이 필요한 경우 원본 파일을 확인하세요.</span>
  </p>
</div>
\`\`\`

**출처 작성 체크리스트:**
- ✅ 본문에서 실제로 사용한 자료만 출처에 포함
- ❌ 사용하지 않은 질병 코드를 출처에 포함하지 않음
- ❌ 사용하지 않은 통계를 출처에 포함하지 않음
- ✅ 보험료 데이터만 사용했다면 보험료 데이터만 출처에 표시
- ✅ 질병 코드를 본문에서 언급했다면 출처에 포함
- ✅ 외부 통계를 본문에서 인용했다면 출처에 포함
- ✅ **판례를 본문에서 인용했다면** → "분쟁조정 사례: 금융분쟁조정위원회 [사건번호]" 추가
- ✅ **Google Custom Search 결과를 사용했다면** → 검색 결과 URL 추가
- ✅ **판례와 검색 결과를 모두 사용했다면** → 둘 다 추가

### B. Info Box (정보 박스 - 이모지 포함)
* **Tip Box:** '💡 손해사정사의 꿀팁', '🔍 질병코드 체크' 등 제목 앞에 관련 이모지를 포함한 예쁜 디자인의 카드 박스.

---

# 5. Output Format (출력 형식 - 절대 규칙!)

⚠️ 출력 형식 위반 시 즉시 실패로 간주합니다.

**절대 금지:**
* 마크다운 코드 블록 (\`\`\`html ... \`\`\`) 사용 금지
* 서론에 "여기 HTML 코드입니다" 같은 잡담 금지
* HTML 코드 외의 어떤 텍스트도 포함하지 말 것

**필수 구조:**
* 첫 줄은 무조건 \`<!DOCTYPE html>\`로 시작
* 마지막 줄은 무조건 \`</html>\`로 종료
* \`<head>\` 안에 다음 요소들을 반드시 포함하세요:
  - \`<meta charset="UTF-8">\`
  - \`<meta name="viewport" content="width=device-width, initial-scale=1.0">\`
  - \`<meta name="description" content="(여기에 본문 내용을 150자 내외로 요약한 매력적인 소개글을 자동 생성해서 넣으세요)">\`
  - \`<title>\` 태그 (SEO 최적화된 제목)
  - \`<style>\` 태그 (아래 프리미엄 디자인 CSS 코드 포함)

---

# 6. Premium CSS Design (프리미엄 디자인 CSS - 필수!)

**반드시 이 CSS를 \`<style>\` 태그 안에 포함하세요:**

\`\`\`css
<style>
@import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');

:root {
    --primary: #3683f1;
    --primary-light: #eef6ff;
    --navy: #25467a;
    --bg: #f8f9fa;
    --success: #059669;
    --warning: #d97706;
    --danger: #dc2626;
    --radius: 20px;
    --shadow: 0 10px 30px -5px rgba(0,0,0,0.08), 0 4px 10px -3px rgba(0,0,0,0.03);
}

body {
    font-family: "Pretendard", -apple-system, BlinkMacSystemFont, sans-serif;
    line-height: 1.8;
    background: var(--bg);
    color: #374151;
    margin: 0;
    padding: 20px;
    word-break: keep-all;
    max-width: 900px;
    margin: 0 auto;
}

h1 { 
    font-size: 26px; 
    font-weight: 900; 
    color: var(--navy); 
    margin-bottom: 25px; 
    letter-spacing: -0.02em;
    line-height: 1.4;
}

h2 {
    font-size: 22px; 
    font-weight: 800; 
    color: var(--navy); 
    margin-top: 50px; 
    margin-bottom: 20px;
    display: flex; 
    align-items: center;
}
h2::before {
    content: ''; 
    display: inline-block; 
    width: 6px; 
    height: 24px;
    background: linear-gradient(to bottom, var(--primary), var(--navy));
    margin-right: 12px; 
    border-radius: 4px;
}

p { 
    margin-bottom: 20px; 
    font-size: 16px; 
    line-height: 1.9;
}

strong { 
    color: var(--navy); 
    font-weight: 800; 
    box-shadow: inset 0 -10px 0 var(--primary-light); 
}

table {
    width: 100%; 
    border-collapse: separate; 
    border-spacing: 0;
    background: #fff; 
    border-radius: var(--radius); 
    overflow: hidden;
    box-shadow: var(--shadow); 
    margin: 40px 0; 
    font-size: 14px;
}
th { 
    background: linear-gradient(to right, #f1f5f9, #e2e8f0); 
    color: var(--navy); 
    padding: 15px; 
    font-weight: 800; 
    text-align: center; 
    border-bottom: 2px solid #fff; 
}
td { 
    padding: 15px; 
    border-bottom: 1px solid #f1f5f9; 
    text-align: center; 
    vertical-align: middle; 
}
tr:first-child td { 
    font-weight: 700; 
    background: #f0fdf4; 
    color: var(--success); 
}

/* 이미지 겹침 방지 - 필수! */
img, svg, .diagram-container, .chart-container {
    display: block;
    max-width: 100%;
    height: auto;
    margin: 30px 0;
    clear: both;
    position: relative;
}

.box {
    background: #fff; 
    padding: 30px; 
    border-radius: var(--radius); 
    box-shadow: var(--shadow); 
    margin: 40px 0; 
    position: relative; 
    overflow: hidden;
    clear: both;
}
.box::before { 
    content: ''; 
    position: absolute; 
    top: 0; 
    left: 0; 
    width: 6px; 
    height: 100%; 
    background: var(--primary); 
}
.box-title { 
    font-size: 18px; 
    font-weight: 800; 
    color: var(--primary); 
    margin-bottom: 15px; 
    display: block; 
}
.warning-box::before { background: var(--danger); }
.warning-box .box-title { color: var(--danger); }
.tip-box { 
    background: var(--primary-light); 
    border: none; 
}
.tip-box::before { display: none; }

.cta-button {
    display: block; 
    width: 100%; 
    max-width: 400px; 
    margin: 60px auto;
    background: linear-gradient(135deg, var(--primary), var(--navy));
    color: white; 
    text-align: center; 
    padding: 18px; 
    border-radius: 50px;
    font-weight: 800; 
    font-size: 18px; 
    text-decoration: none;
    box-shadow: 0 15px 35px -5px rgba(54, 131, 241, 0.4);
    transition: transform 0.2s;
}
.cta-button:hover { transform: translateY(-3px); }

@media (max-width: 480px) {
    body { padding: 15px; } 
    h1 { font-size: 22px; } 
    th, td { padding: 10px 5px; font-size: 12px; }
}
</style>
\`\`\`

---

# 7. 작성 요청 (Request)

${searchResults ? `
### 🔍 실시간 검색 결과 (최신 정보 참고)

**⚠️ 중요:** 아래 검색 결과는 최신 정보를 반영하기 위한 참고 자료입니다. 검색 결과의 정보를 활용하되, 출처를 명확히 표기하세요.

${searchResults}

**검색 결과 활용 지침 (⚠️ 매우 중요 - 적극 활용 필수!):**

1. **상품명이 포함된 경우 - 상품별 심층 검색 활용:**
   - 주제나 키워드에 특정 보험사명(예: "하나생명", "삼성생명", "교보생명" 등)이나 상품명이 포함되어 있으면, 검색 결과에서 해당 상품의 정보를 적극 활용하세요.
   - ✅ **상품별 장점 구체적 설명 필수:**
     - "이 상품은 [검색 결과에서 찾은 구체적 특징]이 있어서 [이런 상황]에서 특히 유리해요"
     - "하나생명 질병후유장해 특약의 경우, [검색 결과 기반 구체적 장점]이 있어서 [이런 고객]에게 추천드려요"
   - ✅ **상품별 단점도 솔직하게:**
     - "다만 [검색 결과 기반 단점]이 있어서, [이런 경우]에는 다른 상품을 고려해볼 수 있어요"
   - ❌ 절대 금지: "좋은 상품입니다", "추천합니다" 같은 일반적 표현

2. **통계 데이터 적극 활용:**
   - 검색 결과에 통계가 있으면 → 본문에 자연스럽게 포함 (200자 이상 확장)
   - 예: "최근 [검색 결과 출처]에 따르면, [구체적 통계 내용]이 증가하고 있어요. 이는 [이유 설명] 때문인 것으로 보입니다"
   - ⚠️ 반드시 출처를 "참고 자료 및 출처" 섹션에 추가

3. **최신 동향 및 트렌드 적극 반영:**
   - 검색 결과의 최신 정보를 본문에 반영 (200자 이상 확장)
   - 예: "2025년 기준으로 [검색 결과 기반 최신 동향]이 나타나고 있어요. 이는 [이유 및 배경 설명] 때문입니다"
   - 검색 결과의 사례나 경험담도 본문에 통합

4. **상품 비교 정보 활용:**
   - 검색 결과에 다른 상품과의 비교 정보가 있으면 → 본문에 비교 섹션 추가
   - "A사와 B사를 비교해보면, [검색 결과 기반 구체적 차이점]이 있어요"

5. **출처 명시:**
   - 검색 결과를 사용했다면 → 반드시 출처 섹션에 URL 추가
   - Google Custom Search와 Grounding에서 제공한 URL 모두 포함

6. **⚠️ 매우 중요 - 검색 결과 활용 강화:**
   - 검색 결과를 단순히 "참고"만 하지 말고, 본문의 핵심 내용으로 적극 활용하세요!
   - 검색 결과가 주제와 관련이 있으면 → 반드시 본문에 200자 이상으로 통합
   - 검색 결과의 정보를 그대로 복사하지 말고, 본문 맥락에 맞게 재구성하여 자연스럽게 통합
   - 검색 결과가 없어도 Grounding으로 자동 검색된 정보가 있으면 그것을 활용하세요!

---

` : `
**⚠️ 검색 결과가 없는 경우:**
- ✅ 제공된 데이터(보험료, 질병코드)만 사용
- ✅ 정성적 표현으로 대체 ("최근 증가 추세", "많은 케이스에서")
- ❌ 검색 결과가 없다고 언급하지 않기
- ❌ 가상의 통계 만들지 않기

---
`}

${!topic && designSheetAnalysis ? `
### 📄 제안서 기반 자동 생성 모드

**⚠️ 중요:** 주제와 키워드가 제공되지 않았으므로, 제안서 분석 결과를 바탕으로 자동으로 주제와 키워드를 생성하여 글을 작성하세요.

**제안서 분석 결과:**
- **상품명:** ${designSheetAnalysis.productName}
- **대상 고객:** ${designSheetAnalysis.targetPersona}
- **고객 고민점:** ${designSheetAnalysis.worryPoint}
- **주요 장점:** ${designSheetAnalysis.sellingPoint}

**자동 생성된 주제:** 제안서의 상품명과 대상 고객을 바탕으로 적절한 주제를 설정하세요.
**자동 생성된 키워드:** 제안서의 상품명과 주요 특징을 바탕으로 핵심 키워드를 추출하세요.

**작성 지침:**
1. 제안서 분석 결과를 바탕으로 주제와 키워드를 자연스럽게 본문에 반영하세요.
2. 제안서 이미지는 본문 중간에 자동으로 포함됩니다.
3. **⚠️ 매우 중요: 제안서에 나온 실제 상품명(예: "흥국화재 무배당 흥Good The편한 운전자상해보험")은 절대 본문에 노출하지 마세요!** 심의 기준 위반입니다.
4. 제안서의 보장 내용과 보험료를 본문에서 자연스럽게 언급하되, 상품명은 "A사", "B사" 등으로 익명화하세요.
5. 제안서 분석 결과의 고민점과 장점을 본문에 적절히 통합하세요.

---
` : `
**주제:** ${topic}
**키워드:** ${keywords}
**상품 강조:** ${product === 'auto' ? '자동 추천 (AI 판단)' : product}
**톤:** ${selectedTone}
**대상:** ${age}세 ${gender}성${detectedProductName ? `

**⚠️ 상품명 감지됨:** ${detectedProductName}

**매우 중요 - 상품별 심층 분석 필수:**
1. **반드시 별도 섹션으로 해당 상품의 장단점을 구체적으로 분석하세요!**
2. **구체적 장점 설명 (300~500자 필수):**
   - "이 상품은 [구체적 특징]이 있어서 [이런 상황]에서 특히 유리해요"
   - "하나생명 질병후유장해 특약의 경우, [구체적 장점]이 있어서 [이런 고객]에게 추천드려요"
   - "이런 특약은 [구체적 특징]이 있어서, [이런 이유]로 좋아요"
   - ❌ 절대 금지: "좋은 상품입니다", "추천합니다" 같은 일반적 표현
3. **단점도 솔직하게 (200~300자):**
   - "다만 [구체적 단점]이 있어서, [이런 경우]에는 다른 상품을 고려해볼 수 있어요"
4. **검색 결과 활용:** Google Custom Search와 Grounding으로 찾은 ${detectedProductName} 관련 정보를 적극 활용하여 구체적인 내용을 작성하세요!
` : ''}

${designSheetImage && designSheetAnalysis ? `
### 📄 제안서 분석 결과 (참고 자료)

제안서 이미지가 제공되었으며, 다음 정보가 분석되었습니다:

- **상품명:** ${designSheetAnalysis.productName}
- **대상 고객:** ${designSheetAnalysis.targetPersona}
- **고객 고민점:** ${designSheetAnalysis.worryPoint}
- **주요 장점:** ${designSheetAnalysis.sellingPoint}

**우선 활용 순서:**

1. **고객 고민점 (worryPoint)**: 도입부나 본문 초반에 자연스럽게 통합
   - 예: "많은 고객님들이 ${designSheetAnalysis.worryPoint}을 걱정하시는데요..."

2. **주요 장점 (sellingPoint)**: 본문 중간에서 장점 설명 시 활용
   - 예: "이런 보험이 특히 좋은 이유는 ${designSheetAnalysis.sellingPoint} 때문이에요"

3. **대상 고객 (targetPersona)**: 본문에서 타겟팅 시 활용
   - 예: "${designSheetAnalysis.targetPersona}에게 특히 추천드리고 싶은 이유는..."

**⚠️ 중요:**
1. **주제와 키워드가 우선입니다.** 제공된 주제와 키워드를 중심으로 글을 작성하세요.
2. 제안서 분석 결과는 참고 자료로 활용하되, 주제와 키워드와 자연스럽게 연결하세요.
3. 제안서 이미지는 본문 중간에 자동으로 포함됩니다.
4. **⚠️ 매우 중요: 제안서에 나온 실제 상품명(예: "흥국화재 무배당 흥Good The편한 운전자상해보험")은 절대 본문에 노출하지 마세요!** 심의 기준 위반입니다. 보험료와 특약 내용은 언급하되, 상품명은 "A사", "B사" 등으로 익명화하세요.

---
` : '---'}
`}

# 8. SEO Optimization (검색 최적화)

**⚠️ H1 제목 작성 규칙 (매우 중요!):**
- **심의 규정 준수:** "최고", "유일", "무조건", "100% 보장" 같은 단정적 표현 절대 금지
- **자극적이면서도 안전한 표현 사용:**
  - ✅ "2026년 {주제}, 당신의 지갑을 지킬 마지막 골든타임"
  - ✅ "{주제} 인상 예고, 놓치면 안 되는 필수 체크리스트"
  - ✅ "당신이 모르는 {주제}의 숨겨진 진실"
  - ✅ "{주제} 선택의 함정, 반드시 알아야 할 3가지"
  - ✅ "{주제} 가이드, 지금 바로 확인해야 하는 이유"
  - ✅ "{주제} 비교, 이 정보 없이는 선택하지 마세요"
  - ✅ "{주제} 완벽 가이드, 전문가가 알려주는 모든 것"
- **긴급성/시급성 강조:** "골든타임", "마지막 기회", "지금 바로", "놓치면 안 되는", "반드시" 등 사용
- **질문형/경고형 제목:** "왜 내 {주제}만 계속 오를까?", "{주제}의 함정" 등 사용

${!topic && designSheetAnalysis ? `
* **H1:** 제안서의 상품명을 바탕으로 자극적이면서도 심의 규정을 준수하는 제목 작성 (예: "2026년 {상품명} 인상 예고, 당신의 지갑을 지킬 마지막 골든타임")
* **H2:** 제안서 분석 결과의 주요 특징을 롱테일 키워드로 활용
* **Meta Description:** 제안서의 상품명과 주요 장점을 포함한 150자 이내 매력적인 요약
* **본문:** 제안서 분석 결과의 키워드를 자연스럽게 배치 (키워드 밀도 2~3%)
` : `
* **H1:** 메인 키워드 "${topic}"을 포함하되, 위의 자극적 제목 작성 규칙을 따라 작성하세요. 단순히 "${topic}"만 쓰지 말고, "2026년 ${topic} 인상 예고, 당신의 지갑을 지킬 마지막 골든타임" 같은 형식으로 작성하세요.
* **H2:** 롱테일 키워드 3~5개 (${keywords}에서 추출)
* **Meta Description:** 150자 이내 매력적인 요약
* **본문:** 키워드를 자연스럽게 배치 (키워드 밀도 2~3%)
`}

---

# 9. Visual Components (시각화 - 필수!)

### 반드시 포함할 요소:

1. **보험료 비교표** (HTML \`<table>\`)
   - 상위 3개 보험사 비교
   - 실제 데이터 기반
   - 1위 가격 강조 (빨간색/초록색)

2. **정보 박스 2~3개**
   - 💡 손해사정사의 꿀팁
   - ⚠️ 주의사항
   - 🔍 질병코드 체크

3. **SVG 다이어그램 1~2개** (선택 - **매번 다른 스타일 필수!**)
   - **⚠️ 매우 중요: 같은 다이어그램 형식을 반복하지 마세요!**
   - 보험료 비교: Bar/Line/Pie/Table/Card Grid 중 **매번 다르게 선택**
   - 보장 범위: Venn/Target/Tree/Bubble/Nested/Sunburst 중 **매번 다르게 선택**
   - 절차 흐름: Flowchart/Roadmap/Timeline/Process/Circular/Funnel 중 **매번 다르게 선택**
   - 장단점 비교: Balance/VS Card/Split/Pros-Cons/Matrix/T-Chart 중 **매번 다르게 선택**
   - 경고 강조: Traffic Light/Warning Board/Alert Badge/Triangle/Exclamation/Banner 중 **매번 다르게 선택**
   - **색상도 매번 다르게:** Blue, Navy, Teal, Red 외에도 Purple, Green, Orange, Pink, Indigo 등 변주
   - **레이아웃도 매번 다르게:** 수평/수직/대각선/원형/계층형 등 다양하게
   
**⚠️ SVG 차트 제목 규칙:**
- ❌ "월보험료 비교 데이터 시각화"
- ✅ "월보험료 비교"
- 보험료 관련 차트는 반드시 차트 하단에 "※ ${age}세 / ${gender === '남' ? '남' : '여'} / 직업급수 1급기준" 표시

**⚠️ 이미지/다이어그램 배치 규칙:**
- 모든 이미지, SVG, 차트는 반드시 \`display: block; margin: 30px 0; clear: both;\` 속성을 사용하여 겹치지 않게 배치
- 이미지/다이어그램 앞뒤에 충분한 여백(30px 이상) 확보
- 절대 \`position: absolute;\`로 겹치게 배치하지 말 것

---

# 10. Compliance (심의 준수 - 필수!)

### A. 금지 사항
* **단정적 표현 금지:** "최고", "유일", "무조건", "100% 보장" 등
* **익명화:** 보험사명은 A사, B사, C사로 익명화 (단, 보험료는 정확히!)
* **상품명 노출 금지 (매우 중요!):** 
  - ❌ 테이블이나 본문에 실제 상품명 사용 절대 금지 (예: "흥국화재 무배당 흥Good The편한 운전자상해보험", "삼성생명 실손보험" 등)
  - ❌ 제안서 분석 결과에 나온 상품명도 본문에 절대 노출하지 마세요!
  - ✅ 보험사는 "A사", "B사", "C사"로만 표기
  - ✅ 보험료와 보장 내용은 언급 가능하되, 상품명은 절대 언급하지 마세요!
* **분쟁사례 마스킹 절대 금지:** 
  - ❌ "금융분쟁조정위원회 제2023-XXX호" (XXX 마스킹 금지!)
  - ❌ "금융분쟁조정위원회 유사 사례" (사건번호 없이 사용 금지!)
  - ✅ **정확한 사건번호가 확인된 경우에만** "금융분쟁조정위원회 제2023-1234호"와 같이 정확히 명시
  - ✅ 사건번호를 모르면 분쟁사례를 아예 언급하지 말고, 대신 정성적 표현 사용

### B. 통계 및 수치 사용 규칙 (매우 중요!)
**⚠️ 통계 수치 사용 시 반드시 지켜야 할 규칙:**

1. **정확한 출처가 있는 통계만 사용:**
   - ✅ "건강보험심사평가원 2023년 통계에 따르면..."
   - ✅ "금융감독원 보험통계 2024년 기준..."
   - ✅ "대한의사협회 발표 자료에 의하면..."
   - ❌ "약 XX%", "대략 XX명" 등 출처 없는 수치

2. **출처 명시 방법:**
   \`\`\`
   (출처: 건강보험심사평가원, 2023년 뇌혈관질환 통계, 2024.03.15 발표)
   \`\`\`

3. **출처가 불확실하면 아예 사용하지 마세요:**
   - ❌ "전체 환자 중 약 15%" (출처 없음)
   - ❌ "건강보험심사평가원 통계에 따르면 15%" (출처 미제공 시)
   - ✅ "일부 환자의 경우" (정성적 표현)
   - ✅ "상당수의 케이스에서" (정성적 표현)
   - ✅ "많은 전문가들이 지적하는" (정성적 표현)

4. **통계 예시 (잘못된 예):**
   - ❌ "건강보험심사평가원 통계에 따르면, 전체 뇌졸중 환자 중 뇌출혈(I60-I62) 환자는 약 15%에 불과합니다"
   - 이유: 출처 URL이나 발표 연도가 명시되지 않았고, 실제 데이터를 확인할 수 없음. 심의 위반!

5. **올바른 표현 예시:**
   - ✅ "뇌졸중은 뇌출혈(I60-I62)과 뇌경색(I63)으로 구분됩니다"
   - ✅ "뇌출혈보다 뇌경색이 더 흔한 것으로 알려져 있습니다"
   - ✅ "일반적으로 뇌경색 환자가 더 많습니다"

6. **제공된 데이터만 사용:**
   - ✅ Google Sheets의 보험료 데이터: 정확하므로 사용 가능
   - ✅ KCD-9 질병코드: 공식 코드이므로 사용 가능
   - ❌ 외부 통계: 출처 URL 없으면 사용 금지!
   - ❌ 백분율/퍼센트: 검증 불가능하면 사용 금지!

### C. 출처 섹션 (출처가 있을 때만!)

**[매우 중요] 출처 섹션 작성 규칙:**

1. **출처가 있는 경우에만 섹션 생성:**
   - 통계, 데이터, 외부 자료를 **실제로 본문에서 사용한 경우에만** "참고 자료 및 출처" 섹션을 추가하세요.
   - 출처가 전혀 없는 경우 이 섹션을 완전히 생략하세요.
   - **⚠️ 매우 중요:** 본문에서 사용하지 않은 자료는 절대 출처에 포함하지 마세요!
     - 예: 질병 코드를 본문에서 언급하지 않았다면 출처에 질병 코드를 포함하지 않음
     - 예: 보험료 데이터만 사용했다면 보험료 데이터만 출처에 표시
     - 예: 외부 통계를 사용하지 않았다면 통계 출처를 포함하지 않음

2. **출처 섹션 작성 규칙 (실제 사용한 자료만!):**
   
   **✅ 올바른 예시 1: 보험료 데이터만 사용한 경우 (질병 코드 미사용):**
   \`\`\`html
   <div class="box" style="background: #f0f9ff; margin-top: 50px;">
     <p><strong>📚 참고 자료 및 출처</strong></p>
     <ul style="line-height: 2; font-size: 14px; list-style: none; padding-left: 0;">
       <li style="margin-bottom: 10px;">
         • 보험료 데이터: 자체 수집 데이터 (${todayStr} 기준)
       </li>
     </ul>
   </div>
   \`\`\`
   
   **✅ 올바른 예시 2: 보험료 데이터 + 질병 코드를 본문에서 실제로 사용한 경우:**
   \`\`\`html
   <div class="box" style="background: #f0f9ff; margin-top: 50px;">
     <p><strong>📚 참고 자료 및 출처</strong></p>
     <ul style="line-height: 2; font-size: 14px; list-style: none; padding-left: 0;">
       <li style="margin-bottom: 10px;">
         • 보험료 데이터: 자체 수집 데이터 (${todayStr} 기준)
       </li>
       <li style="margin-bottom: 10px;">
         • 질병 코드: <a href="https://www.koicd.kr/" target="_blank" style="color: var(--primary); text-decoration: underline;">통계청 한국표준질병사인분류 KCD-9</a>
       </li>
     </ul>
   </div>
   \`\`\`
   
   **❌ 잘못된 예시: 질병 코드를 본문에서 사용하지 않았는데 출처에 포함:**
   - 본문에서 질병 코드(I63, I61 등)를 언급하지 않았다면 출처에 질병 코드를 포함하지 마세요!
   - 보험료 데이터만 사용했다면 보험료 데이터만 출처에 표시하세요!

3. **외부 통계를 실제로 사용했다면 반드시 추가 (구체적 다운로드 URL!):**

   **⚠️ 매우 중요:** URL은 메인 페이지가 아닌, **실제 PDF/Excel 파일을 다운로드할 수 있는 구체적인 페이지 링크**여야 합니다!

\`\`\`html
    <li style="margin-bottom: 10px;">
      • 암 발생 통계: <a href="https://cancer.go.kr/lay1/bbs/S1T674C675/B/62/view.do?article_seq=9876&cpage=1" target="_blank" style="color: var(--primary); text-decoration: underline;">국가암정보센터 「2023년 국가암등록통계」 (PDF 다운로드 가능)</a>
    </li>
    <li style="margin-bottom: 10px;">
      • 뇌혈관질환 통계: <a href="https://www.hira.or.kr/bbsDummy.do?pgmid=HIRAA020041000100&brdScnBltNo=4&brdBltNo=10627" target="_blank" style="color: var(--primary); text-decoration: underline;">건강보험심사평가원 「2023년 주요 질병 통계」 (Excel 다운로드 가능)</a>
    </li>
    <li style="margin-bottom: 10px;">
      • 심장질환 현황: <a href="https://kdca.go.kr/board/board.es?mid=a20501010000&bid=0015&act=view&list_no=720844" target="_blank" style="color: var(--primary); text-decoration: underline;">질병관리청 「심혈관질환 예방관리 백서 2023」 (PDF 다운로드)</a>
    </li>
\`\`\`

   **URL 작성 규칙:**
   - 메인 홈페이지 ❌
   - 통계 페이지 ❌
   - 실제 자료실/게시판의 해당 글 링크 ✅
   - PDF/Excel 다운로드 버튼이 있는 페이지 ✅

4. **출처 섹션 닫기:**
   - 보험료 데이터만 사용한 경우: \`</ul></div>\`로 끝
   - 외부 통계를 사용한 경우에만 아래 "원본 자료 다운로드" 안내 추가:
\`\`\`html
  </ul>
  <p style="font-size: 13px; color: #333; margin-top: 15px; padding: 15px; background: #fff3cd; border-radius: 8px; line-height: 1.8;">
    💡 <strong>원본 자료 다운로드:</strong><br/>
    위 링크를 클릭하면 각 기관의 자료실 페이지로 이동합니다.<br/>
    해당 페이지에서 <strong>PDF 또는 Excel 파일을 직접 다운로드</strong>하실 수 있습니다.<br/>
    <span style="color: #d97706;">※ 정확한 통계 검증이 필요한 경우 원본 파일을 확인하세요.</span>
  </p>
</div>
\`\`\`

**⚠️ 출처 작성 최종 체크리스트:**
- [ ] 본문에서 실제로 사용한 자료만 출처에 포함했는가?
- [ ] 질병 코드를 본문에서 언급하지 않았다면 출처에서 제외했는가?
- [ ] 보험료 데이터만 사용했다면 보험료 데이터만 출처에 표시했는가?
- [ ] 외부 통계를 사용하지 않았다면 통계 출처를 포함하지 않았는가?

<!-- 필수안내사항 (본문에 1회 이상 노출 필수!) -->
<div class="box" style="margin-top: 30px; font-size: 13px; color: #dc2626; background: #fef2f2; border-left: 4px solid #dc2626; padding: 20px;">
  <p style="color: #dc2626; font-weight: 700; margin-bottom: 10px;">⚠️ 필수 안내사항</p>
  <p style="color: #991b1b; line-height: 1.8;">
    • 본 내용은 모집종사자 개인의 의견이며, 계약 체결에 따른 이익 또는 손실은 보험계약자 등에게 귀속됩니다.<br/>
    • 보험사 및 상품별로 상이할 수 있으므로, 관련한 세부사항은 반드시 해당 약관을 참조하시기 바랍니다.<br/>
    ${topInsurance.length > 0 ? '• 위 보험료는 보험나이, 성별, 직업에 따라 변동될 수 있는 예시입니다.<br/>' : ''}
  </p>
</div>

\`\`\`

---

# 11. Final Instruction (최종 지시)

위 모든 가이드라인을 준수하여, **순수 HTML 코드만** 출력하세요.
- 첫 줄: \`<!DOCTYPE html>\`
- 마지막 줄: \`</html>\`
- 마크다운 없이, 주석 없이, 순수 HTML만!
- 전체 문서가 완성된 형태로!

**⚠️ 최종 체크리스트:**
- [ ] 상품명 노출 없음
- [ ] 출처 없는 통계/백분율 사용 안 함
- [ ] 제공된 보험료 데이터만 사용
- [ ] 정성적 표현 사용 ("일부", "많은", "상당수")
- [ ] 단정적 표현 금지 ("최고", "무조건")
- [ ] A사/B사/C사 익명화
- [ ] **분쟁사례: 정확한 사건번호만 사용 (XXX 마스킹 절대 금지!)**
- [ ] 출처가 있을 때만 "참고 자료 및 출처" 섹션 포함
- [ ] 판례를 인용했다면 출처에 사건번호 추가
- [ ] 검색 결과를 사용했다면 출처에 URL 추가
- [ ] 톤이 자연스럽고 친근한지 확인 (딱딱한 리포트 느낌 없음)
- [ ] 담보별 보험료가 주제에 맞게 필터링되었는지 확인

**지금 바로 ${topic}에 대한 전문적인 보험 블로그 글을 작성하세요!**`
}

/**
 * 프롬프트 버전 정보
 */
export const PROMPT_VERSION = {
  version: '2.0',
  lastUpdated: '2024-12-06',
  description: '보험 블로그 자동 생성 - 프리미엄 롱폼 콘텐츠',
  features: [
    '2,500자 이상 롱폼',
    '실제 보험료 데이터 기반',
    'KCD-9 질병코드 통합',
    '판례집 통합 (260개 판례)',
    'Google Custom Search 통합',
    '담보별 보험료 필터링',
    'SVG 시각화 (다양한 디자인)',
    '심의 규정 준수',
    'SEO 최적화',
    '자연스러운 톤 (딱딱한 표현 제거)',
  ]
}

