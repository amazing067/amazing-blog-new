# 판례집 통합 사용 가이드

## 📋 개요

1000페이지 분량의 보험분쟁조정사례집 PDF를 효율적으로 처리하여 블로그 생성에 활용하는 방법입니다.

**비용 최적화**: Vision API 대비 **10배 이상 저렴** ✅

---

## 🚀 빠른 시작

### 1단계: PDF 파일 준비

`data` 폴더에 판례집 PDF 파일을 배치하세요:

```
data/
  └── 보험분쟁조정사례집.pdf  ← 여기에 파일 배치
```

### 2단계: PDF 파싱 실행

터미널에서 다음 명령어 실행:

```bash
npm run parse-precedents
```

**예상 소요 시간**: 1000페이지 기준 약 5-10분

**결과**:
- `data/precedents.json` 파일 자동 생성
- 판례별로 분할된 데이터 저장
- 키워드 자동 추출

### 3단계: 자동 통합 완료! ✨

이미 블로그 생성 API에 통합되어 있습니다.

이제 블로그를 생성하면 **자동으로 관련 판례를 찾아서 활용**합니다!

---

## 🔍 작동 원리

### 판례 검색 프로세스

1. **블로그 주제/키워드 입력**
   - 예: "30세 남성 암보험 비교"

2. **자동 판례 검색**
   - 주제/키워드와 관련된 판례 3개 자동 검색
   - 키워드 매칭 점수로 우선순위 결정

3. **프롬프트에 포함**
   - 검색된 판례가 프롬프트에 자동 포함
   - AI가 본문에 자연스럽게 인용

4. **블로그 생성**
   - 정확한 사건번호와 함께 판례 인용
   - 예: "금융분쟁조정위원회 제2023-1234호 사례에서..."

---

## 📊 데이터 구조

### precedents.json 구조

```json
[
  {
    "caseNumber": "제2023-1234호",
    "title": "암보험 진단비 지급 거절 사건",
    "content": "본 사건은...",
    "keywords": ["암보험", "진단비", "보험금"]
  },
  ...
]
```

---

## 🎯 검색 알고리즘

### 점수 계산 방식

1. **제목 매칭**: 3점
   - 주제/키워드가 제목에 포함

2. **키워드 매칭**: 2점  
   - 자동 추출된 키워드와 일치

3. **내용 매칭**: 1점
   - 본문 내용에 포함

4. **정확 일치 보너스**: +5점
   - 키워드가 정확히 일치

### 예시

**입력**: "30세 남성 암보험 비교"

**검색어**: ["30세", "남성", "암보험", "비교"]

**결과**: 암보험 관련 판례가 높은 점수로 선별됨

---

## 🔧 고급 설정

### 최대 판례 개수 변경

`app/api/generate/route.ts` 파일에서:

```typescript
const relevantPrecedents = findRelevantPrecedents(topic, keywords, 5)  // 3 → 5로 변경
```

### 키워드 필터링 커스터마이징

`lib/precedents.ts`의 `INSURANCE_KEYWORDS` 배열에 키워드 추가:

```typescript
const INSURANCE_KEYWORDS = [
  '암보험', '실손보험', 
  // 여기에 키워드 추가
]
```

---

## 📝 판례 파싱 재실행

PDF 파일이 업데이트된 경우:

```bash
npm run parse-precedents
```

기존 `precedents.json` 파일이 덮어씌워집니다.

---

## ⚠️ 주의사항

### 1. PDF 형식

- **텍스트 기반 PDF**: 정상 작동 ✅
- **이미지 기반 PDF (스캔본)**: OCR 필요, 정확도 낮을 수 있음 ⚠️

### 2. 사건번호 패턴

현재 인식 패턴: `제YYYY-NNNN호`

- ✅ "제2023-1234호"
- ✅ "제2018-12호"
- ❌ 다른 형식은 인식 안 됨

### 3. 파일 크기

- **1000페이지**: 약 10-20MB JSON 파일 생성
- **메모리**: 약 50-100MB 사용

---

## 💰 비용 비교

| 방법 | 초기 비용 | 블로그당 비용 |
|------|----------|--------------|
| Vision API | - | $5-10 |
| **PDF 텍스트 추출** | **무료** | **무료** ✅ |

---

## 🐛 문제 해결

### 판례가 검색되지 않아요

1. `data/precedents.json` 파일이 있는지 확인
2. PDF 파싱이 완료되었는지 확인
3. 주제/키워드가 너무 일반적인지 확인 (예: "보험")

### 파싱 오류

1. PDF 파일 경로 확인: `data/보험분쟁조정사례집.pdf`
2. PDF 파일이 손상되지 않았는지 확인
3. Node.js 버전 확인 (v18 이상 권장)

### 판례 인용이 정확하지 않아요

1. `precedents.json`의 `caseNumber` 필드 확인
2. 사건번호 패턴이 올바른지 확인

---

## 🔮 향후 개선 방안

### Phase 2: 벡터 검색 (추천)

현재는 키워드 매칭 방식이지만, 나중에 벡터 검색으로 업그레이드 가능:

- **정확도 향상**: 의미 기반 검색
- **확장성**: 판례가 더 많아져도 OK
- **비용**: 초기 임베딩 후 매우 저렴

---

## 📞 지원

문제가 있으면:
1. 터미널 로그 확인
2. `data/precedents.json` 파일 확인
3. 판례 파싱 재실행

---

**즐거운 블로그 작성 되세요! 🎉**

