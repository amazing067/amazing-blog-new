# Q&A 프롬프트 중복 분석 및 개선안

**작성일**: 2024-12-16  
**분석 대상**: `lib/prompts/qa-prompt.ts` (1700줄)

---

## 📊 답변 길이 통일 제안

### 현재 상태
- `short`: 150-250자
- `default`: 300-700자

### 제안: 단일 길이로 통일
**50-150자 (최대 200자 절대 초과 금지)**

**이유:**
1. ✅ 실제 카페 답변이 50-150자가 대부분
2. ✅ 두 옵션으로 나누면 사용자가 혼란스러움
3. ✅ 핵심, 기본정보, 상세정보 모두 50-150자에 포함 가능
4. ✅ 간결하면서도 필요한 정보는 모두 전달 가능

**구현 방법:**
- 프롬프트에서 `answerLength` 옵션 제거
- 모든 답변을 50-150자로 통일
- API 후처리로 200자 초과 시 자동 자르기

---

## 🔍 중복 내용 분석

### 1. 마침표 사용 금지 (25회 반복)

**위치:**
- 245줄: 질문 프롬프트 - 마침표 사용 절대 금지
- 383줄: 질문 본문 규칙 - 마침표 사용 절대 금지
- 509줄: 질문 주의사항 - 마침표 사용 절대 금지
- 613줄: 답변 프롬프트 - 마침표 사용 절대 금지
- 627줄: 답변 구체적 답변 - 마침표 사용 절대 금지
- 650줄: 답변 전문적 답변 - 마침표 사용 절대 금지
- 658줄: 답변 비교 제시 - 마침표 사용 절대 금지
- 678줄: 답변 가입 유도 - 마침표 사용 절대 금지
- 796줄: 답변 문단 구성 - 첫 문단 마침표 금지
- 948줄: 답변 최종 확인 - 마침표 사용 절대 금지
- 958줄: 답변 주의사항 - 마침표 사용 절대 금지
- 959줄: 답변 주의사항 - 첫 문단 마침표 금지
- 1211줄: 대화형 고객 댓글 - 마침표 사용 절대 금지
- 1214줄: 대화형 고객 댓글 - 마침표 사용 절대 금지
- 1219줄: 대화형 고객 댓글 출력 형식 - 마침표 사용 절대 금지
- 1422줄: 대화형 설계사 댓글 - 마침표 사용 절대 금지
- 1424줄: 대화형 설계사 댓글 - 마침표 사용 절대 금지
- 1454줄: 대화형 설계사 댓글 출력 형식 - 마침표 사용 절대 금지
- 1577줄: 후기성 문구 - 마침표 사용 절대 금지
- 1579줄: 후기성 문구 - 마침표 사용 절대 금지
- 1597줄: 후기성 문구 출력 형식 - 마침표 사용 절대 금지
- 1682줄: 후기 응답 - 마침표 사용 절대 금지
- 1684줄: 후기 응답 - 마침표 사용 절대 금지
- 1694줄: 후기 응답 출력 형식 - 마침표 사용 절대 금지

**개선안:**
- 공통 섹션으로 한 번만 명시
- 각 프롬프트 함수 시작 부분에 공통 지침 추가

---

### 2. "매우 중요" 표현 (50회 이상 반복)

**위치:**
- 질문 프롬프트: 207, 208, 222, 269, 299, 301, 322, 326, 332, 338, 343, 349, 378, 395, 489
- 답변 프롬프트: 590, 601, 615, 632, 660, 682, 700, 752, 768, 775, 796, 808, 840, 905, 937, 948, 958, 959
- 대화형 프롬프트: 1056, 1057, 1061, 1080, 1087, 1125, 1167, 1170, 1171, 1193, 1194, 1205, 1206, 1209, 1245, 1264, 1286
- 후기성 프롬프트: 1528, 1529, 1533, 1537, 1539, 1540, 1541, 1561, 1566, 1569, 1571, 1575, 1581, 1582, 1585, 1589, 1633, 1640, 1642, 1643, 1644, 1675, 1676

**개선안:**
- "매우 중요" 표현을 최소화
- 정말 중요한 것만 강조
- 나머지는 일반 지침으로 변경

---

### 3. 다양성 확보 관련 (15회 반복)

**위치:**
- 395줄: 질문 다양성 확보
- 489줄: 질문 다양성 확보 필수
- 700줄: 답변 다양성 확보
- 937줄: 답변 다양성 확보 필수
- 1167줄: 대화형 다양성 확보
- 1209줄: 대화형 절대 반복 금지
- 1370줄: 대화형 설계사 다양성 확보
- 1416줄: 대화형 설계사 절대 반복 금지
- 1589줄: 후기성 절대 반복 금지
- 1686줄: 후기 응답 다양성 확보

**개선안:**
- 공통 섹션으로 통합
- 각 프롬프트 함수에 한 번만 명시

---

### 4. 문단 구분 관련 (10회 반복)

**위치:**
- 239줄: 질문 문단 구분 필수
- 325줄: 질문 본문 문단 구분 필수
- 514줄: 질문 문단 구분 형식 가이드
- 768줄: 답변 문단 구분 필수
- 810줄: 답변 줄바꿈 규칙
- 840줄: 답변 매우 중요 줄바꿈 규칙
- 905줄: 답변 출력 형식 문단 구분 필수
- 947줄: 답변 최종 확인 문단 구분

**개선안:**
- 공통 포맷팅 가이드로 통합
- 한 곳에만 명시하고 참조

---

### 5. 이모티콘 사용 가이드 (8회 반복)

**위치:**
- 754줄: 답변 이모티콘 사용 가이드라인
- 756줄: 답변 이모티콘 줄바꿈 규칙
- 765줄: 답변 이모티콘 올바른/잘못된 형식
- 812줄: 답변 줄바꿈 규칙 - 이모티콘
- 842줄: 답변 매우 중요 줄바꿈 규칙 - 이모티콘
- 908줄: 답변 출력 형식 - 이모티콘

**개선안:**
- 공통 이모티콘 가이드로 통합
- 한 곳에만 명시

---

### 6. 출력 형식 관련 (6회 반복)

**위치:**
- 484줄: 질문 출력 형식
- 900줄: 답변 출력 형식
- 905줄: 답변 출력 형식 상세
- 1216줄: 대화형 고객 출력 형식
- 1451줄: 대화형 설계사 출력 형식
- 1594줄: 후기성 출력 형식
- 1691줄: 후기 응답 출력 형식

**개선안:**
- 공통 출력 형식 섹션으로 통합
- 각 프롬프트에서 간단히 참조만

---

### 7. 주의사항/절대 금지 (8회 반복)

**위치:**
- 501줄: 질문 주의사항
- 503줄: 질문 절대 하지 말아야 할 것
- 955줄: 답변 주의사항
- 957줄: 답변 절대 하지 말아야 할 것
- 1084줄: 대화형 짜고 치는 느낌 절대 금지
- 1085줄: 대화형 정말 궁금해서 물어보는 자연스러운 톤
- 1125줄: 대화형 반복적 표현 절대 사용하지 마세요
- 1193줄: 대화형 절대 반복 금지

**개선안:**
- 공통 주의사항 섹션으로 통합
- 각 프롬프트에서 간단히 참조만

---

## 📋 중복 제거 우선순위

### Phase 1: 즉시 제거 (명확한 중복)
1. ✅ 마침표 사용 금지 (25회 → 1회)
2. ✅ 출력 형식 (6회 → 1회)
3. ✅ 주의사항/절대 금지 (8회 → 1회)

### Phase 2: 통합 가능 (내용 유사)
4. ✅ 다양성 확보 (15회 → 1회)
5. ✅ 문단 구분 (10회 → 1회)
6. ✅ 이모티콘 사용 가이드 (8회 → 1회)

### Phase 3: 표현 완화 (과도한 강조)
7. ✅ "매우 중요" 표현 (50회 → 10회 이하)
8. ✅ 반복적 경고 표현 완화

---

## 🎯 구체적 개선 계획

### 1. 공통 지침 섹션 생성

```typescript
// 파일 상단에 공통 지침 상수 추가
const COMMON_GUIDELINES = {
  NO_PERIOD: `
⚠️ 마침표(.) 사용 절대 금지:
- 모든 문장 끝에 마침표를 사용하지 마세요
- 물음표(?)나 느낌표(!)는 사용 가능하지만, 마침표는 절대 사용하지 마세요
- 예: "설계서 받았는데요" (O), "설계서 받았는데요." (X)
  `,
  
  OUTPUT_FORMAT: `
[출력 형식]
- 본문만 출력하세요. 마크다운이나 HTML 태그 없이 순수 텍스트만 출력하세요.
- 제어 문자(<ctrl*> 등)나 특수 문자를 포함하지 마세요.
- ${COMMON_GUIDELINES.NO_PERIOD}
  `,
  
  DIVERSITY: `
⚠️ 다양성 확보 필수:
- 매번 생성할 때마다 반드시 다른 패턴, 다른 구조, 다른 표현을 사용하세요
- 이전에 생성한 내용과 동일한 패턴이나 구조를 절대 사용하지 마세요
  `,
  
  PARAGRAPH_FORMAT: `
⚠️ 문단 구분 필수:
- 반드시 3-5개의 문단으로 구성하세요
- 각 문단 사이에는 반드시 빈 줄(줄바꿈 2개, \n\n)을 넣어주세요
- 한 문단에 여러 문장을 자연스럽게 연결하세요
  `
}
```

### 2. 각 프롬프트 함수에서 참조

```typescript
export function generateAnswerPrompt(...) {
  // ... 기존 코드 ...
  
  const answerPrompt = `...프롬프트 내용...
  
${COMMON_GUIDELINES.NO_PERIOD}
${COMMON_GUIDELINES.DIVERSITY}
${COMMON_GUIDELINES.PARAGRAPH_FORMAT}
${COMMON_GUIDELINES.OUTPUT_FORMAT}
  `
}
```

---

## 📊 예상 효과

### 코드 길이 감소
- 현재: 1700줄
- 예상: 1200-1300줄 (약 25-30% 감소)

### 가독성 향상
- 중복 제거로 핵심 내용에 집중
- 공통 지침 한 곳에서 관리

### 유지보수 용이
- 공통 지침 수정 시 한 곳만 변경
- 일관성 유지 용이

---

## 🔧 다음 단계

1. **사용자 확인**: 중복 제거 항목 확인 및 승인
2. **공통 지침 생성**: 파일 상단에 공통 상수 추가
3. **중복 제거**: 각 프롬프트 함수에서 중복 내용 제거
4. **답변 길이 통일**: 50-150자로 통일 및 API 후처리 추가
5. **테스트**: 변경 후 실제 생성 테스트

---

**작성자**: AI Assistant  
**검토 필요**: 사용자 확인 후 적용

